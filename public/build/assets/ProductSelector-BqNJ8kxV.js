import{r as c,j as e}from"./app-b7vnQlZc.js";import{P as H}from"./PricingDisplay-D7eDSExm.js";import{F as ie}from"./filter-nmASna1f.js";import{S as ne}from"./search-CTE1ST23.js";import{c as K}from"./createLucideIcon-BGsZVnCF.js";import{C as de}from"./clock-BQhxh3lv.js";import{C as O}from"./circle-alert-gZJECwuX.js";import{I as Q}from"./info-Bc-ZYgAB.js";import{S as oe}from"./shopping-cart-BZplhbNf.js";import{X as me}from"./x-CdJq2FK8.js";import{P as xe}from"./plus-D89T3Ycf.js";import{T as ue}from"./trending-up-vLl1-uxe.js";import{T as V,B as he}from"./tag-rXdRp6jd.js";import{C as pe}from"./circle-check-big-CbaywUwj.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=K("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=K("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),Re=({selectedProducts:t,onProductsChange:g,showCart:u=!0,recommendationContext:o,productRequestId:l,userRole:f="provider",roleRestrictions:x,className:j="",title:y="Product Catalog Selection",description:m="Choose products from our comprehensive catalog"})=>{const h=(()=>{if(x)return x;switch(f){case"office-manager":return{can_view_financials:!1,can_see_discounts:!1,can_see_msc_pricing:!1,can_see_order_totals:!1,pricing_access_level:"national_asp_only"};case"msc_subrep":return{can_view_financials:!1,can_see_discounts:!1,can_see_msc_pricing:!1,can_see_order_totals:!1,pricing_access_level:"limited"};case"provider":case"msc-rep":case"msc-admin":case"superadmin":default:return{can_view_financials:!0,can_see_discounts:!0,can_see_msc_pricing:!0,can_see_order_totals:!0,pricing_access_level:"full"}}})(),[p,i]=c.useState([]),[S,W]=c.useState([]),[b,L]=c.useState(""),[v,R]=c.useState(""),[w,F]=c.useState(""),[X,M]=c.useState(!0),[G,J]=c.useState([]),[Y,Z]=c.useState([]),[U,ee]=c.useState(!1),[k,se]=c.useState([]),[C,T]=c.useState(!1),[P,z]=c.useState(null),[te,I]=c.useState(!0);c.useEffect(()=>{ae()},[]),c.useEffect(()=>{l&&re()},[l]),c.useEffect(()=>{let s=p;b&&(s=s.filter(a=>a.name.toLowerCase().includes(b.toLowerCase())||a.q_code.toLowerCase().includes(b.toLowerCase())||a.manufacturer.toLowerCase().includes(b.toLowerCase())||a.sku.toLowerCase().includes(b.toLowerCase()))),v&&(s=s.filter(a=>a.category===v)),w&&(s=s.filter(a=>a.manufacturer===w)),W(s)},[p,b,v,w]);const ae=async()=>{try{M(!0);const a=await(await fetch("/api/products/search")).json();i(a.products||[]),J(a.categories||[]),Z(a.manufacturers||[])}catch(s){console.error("Failed to fetch products:",s)}finally{M(!1)}},re=async()=>{if(l)try{T(!0),z(null);const a=await(await fetch(`/api/product-requests/${l}/recommendations`)).json();a.success?se(a.recommendations||[]):(z(a.message||"Failed to load recommendations"),I(!1))}catch(s){console.error("Failed to fetch AI recommendations:",s),z("Unable to load AI recommendations"),I(!1)}finally{T(!1)}},A=(s,a=1,r)=>{const n=t.findIndex(_=>_.product_id===s.id&&_.size===r);let d=[...t];n>=0?d[n].quantity+=a:d.push({product_id:s.id,quantity:a,size:r,product:s}),g(d)},ce=(s,a=1)=>{var d;const r={id:s.product_id,name:s.product_name,sku:"",q_code:s.q_code,manufacturer:s.manufacturer,category:s.category,description:s.reasoning,price_per_sq_cm:s.product_details.msc_price??s.estimated_cost.national_asp,msc_price:s.product_details.msc_price??s.estimated_cost.national_asp,available_sizes:s.product_details.available_sizes,image_url:s.product_details.image_url,commission_rate:0},n=(d=s.suggested_size)==null?void 0:d.toString();A(r,a,n)},$=(s,a,r)=>{if(r<=0){B(s,a);return}const n=t.map(d=>d.product_id===s&&d.size===a?{...d,quantity:r}:d);g(n)},B=(s,a)=>{const r=t.filter(n=>!(n.product_id===s&&n.size===a));g(r)},le=()=>t.reduce((s,a)=>{const r=a.product||p.find(_=>_.id===a.product_id);if(!r)return s;const n=h.can_see_msc_pricing&&r.msc_price||r.price_per_sq_cm,d=a.size?n*parseFloat(a.size):n;return s+d*a.quantity},0),E=()=>{if(!o)return[];const a={DFU:["Biologic","SkinSubstitute"],VLU:["SkinSubstitute","Biologic"],PU:["SkinSubstitute"],TW:["Biologic"],AU:["SkinSubstitute","Biologic"],OTHER:["SkinSubstitute","Biologic"]}[o]||[];return p.filter(r=>a.includes(r.category))},q=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return X?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading product catalog..."})]}):e.jsxs("div",{className:`space-y-6 ${j}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:y}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m," ",o&&`(Optimized for ${o})`]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[S.length," products available"]}),e.jsxs("button",{onClick:()=>ee(!U),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"w-5 h-5 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products by name, Q-code, manufacturer, or SKU...",value:b,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),U&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:v,onChange:s=>R(s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Categories"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manufacturer"}),e.jsxs("select",{value:w,onChange:s=>F(s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Manufacturers"}),Y.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),l&&te&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 mr-2 text-purple-600"}),"AI-Powered Clinical Recommendations"]}),C&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(de,{className:"w-4 h-4 mr-1 animate-spin"}),"Analyzing..."]})]}),P&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-2 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:P})]}),!C&&k.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Based on clinical analysis of wound characteristics, patient factors, and evidence-based protocols."}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:k.slice(0,4).map((s,a)=>e.jsx(be,{recommendation:s,onAdd:ce,rank:a+1,roleRestrictions:h},`ai-rec-${s.product_id}-${a}`))})]}),!C&&k.length===0&&!P&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No AI recommendations available for this request."})]})]}),o&&!l&&E().length>0&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-900 mb-3 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Recommended for ",o]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E().slice(0,6).map(s=>e.jsx(D,{product:s,onAdd:A,isRecommended:!0,roleRestrictions:h},`rec-${s.id}`))})]}),e.jsxs("div",{className:`grid gap-6 ${u?"grid-cols-1 lg:grid-cols-3":"grid-cols-1"}`,children:[e.jsx("div",{className:u?"lg:col-span-2":"col-span-1",children:e.jsx("div",{className:"space-y-4",children:S.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"No products found matching your criteria."}),e.jsx("button",{onClick:()=>{L(""),R(""),F("")},className:"mt-2 text-blue-600 hover:text-blue-800",children:"Clear filters"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(s=>e.jsx(D,{product:s,onAdd:A,roleRestrictions:h},s.id))})})}),u&&e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sticky top-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 mr-2"}),"Selected Products"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," items"]})]}),t.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No products selected yet"}):e.jsxs("div",{className:"space-y-3",children:[t.map((s,a)=>{const r=s.product||p.find(_=>_.id===s.product_id);if(!r)return null;const n=s.size?r.msc_price*parseFloat(s.size):r.msc_price,d=n*s.quantity;return e.jsxs("div",{className:"border border-gray-200 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 line-clamp-1",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Q",r.q_code]}),s.size&&e.jsxs("p",{className:"text-xs text-blue-600",children:["Size: ",s.size," cm²"]})]}),e.jsx("button",{onClick:()=>B(s.product_id,s.size),className:"text-red-500 hover:text-red-700",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>$(s.product_id,s.size,s.quantity-1),className:"w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium w-8 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>$(s.product_id,s.size,s.quantity+1),className:"w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50",children:e.jsx(xe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:q(d)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[q(n)," each"]})]})]})]},`${s.product_id}-${s.size||"no-size"}`)}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:q(le())})]}),!h.can_see_msc_pricing&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"* Pricing shown is National ASP only"})]})]})]})})]})]})},D=({product:t,onAdd:g,isRecommended:u=!1,roleRestrictions:o})=>{var h,p;const[l,f]=c.useState(""),[x,j]=c.useState(1),y=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i),m=()=>{g(t,x,l||void 0),j(1),f("")},N=()=>{const i=o.can_see_msc_pricing&&t.msc_price||t.price_per_sq_cm;return l?i*parseFloat(l)*x:i*x};return e.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-shadow ${u?"border-green-200 bg-green-50":"border-gray-200 bg-white"}`,children:[u&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Recommended"})}),e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2 mb-1",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mb-1",children:[e.jsx(V,{className:"w-3 h-3"}),e.jsxs("span",{children:["Q",t.q_code]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.sku})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:t.manufacturer})]})]})}),e.jsx("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx(H,{roleRestrictions:o,product:{nationalAsp:t.price_per_sq_cm,mscPrice:t.msc_price},showLabel:!0,className:"text-xs"}),o.can_view_financials&&t.commission_rate&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Commission:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[t.commission_rate,"%"]})]})]}),((h=t.available_sizes)==null?void 0:h.length)>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Size (cm²)"}),e.jsxs("select",{value:l,onChange:i=>f(i.target.value),className:"w-full text-xs border border-gray-300 rounded-md py-1 px-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select size..."}),t.available_sizes.map(i=>e.jsxs("option",{value:i.toString(),children:[i," cm² - ",y((o.can_see_msc_pricing&&t.msc_price||t.price_per_sq_cm)*i)]},i))]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:x,onChange:i=>j(Math.max(1,parseInt(i.target.value)||1)),className:"w-full text-xs border border-gray-300 rounded-md py-1 px-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"mb-3 p-2 bg-gray-50 rounded text-center",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["Total: ",y(N())]})}),e.jsx("button",{onClick:m,disabled:((p=t.available_sizes)==null?void 0:p.length)>0&&!l,className:"w-full bg-blue-600 text-white text-sm font-medium py-2 px-3 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Selection"})]})},be=({recommendation:t,onAdd:g,rank:u,roleRestrictions:o})=>{const[l,f]=c.useState(1),x=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(m),j=m=>m>=.8?"text-green-600 bg-green-50":m>=.6?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",y=()=>{g(t,l),f(1)};return e.jsxs("div",{className:"border border-blue-200 rounded-lg p-4 bg-white hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-xs font-bold rounded-full",children:u}),e.jsxs("div",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${j(t.confidence_score)}`,children:[Math.round(t.confidence_score*100),"% confidence"]})]}),e.jsx(ue,{className:"w-4 h-4 text-blue-600"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:t.product_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mb-1",children:[e.jsx(V,{className:"w-3 h-3"}),e.jsxs("span",{children:["Q",t.q_code]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.manufacturer})]}),e.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:t.category})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-md",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-700 mb-1",children:"Clinical Rationale:"}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:t.reasoning})]}),t.key_benefits&&t.key_benefits.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-700 mb-1",children:"Key Benefits:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.key_benefits.slice(0,3).map((m,N)=>e.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-green-100 text-green-700 rounded",children:m},N))})]}),e.jsxs("div",{className:"mb-3 space-y-1",children:[e.jsx("div",{className:"text-xs",children:e.jsx(H,{roleRestrictions:o,product:{nationalAsp:t.estimated_cost.national_asp,mscPrice:t.estimated_cost.msc_price},showLabel:!0,className:"text-xs"})}),o.can_see_discounts&&t.estimated_cost.savings&&t.estimated_cost.savings>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Savings vs ASP:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[x(t.estimated_cost.savings),"(",t.estimated_cost.savings_percentage,"%)"]})]}),t.suggested_size&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Suggested Size:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[t.suggested_size," cm²"]})]})]}),t.contraindications&&t.contraindications.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-red-50 border border-red-200 rounded",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(O,{className:"w-3 h-3 mr-1 text-red-600"}),e.jsx("h4",{className:"text-xs font-medium text-red-700",children:"Contraindications:"})]}),e.jsx("ul",{className:"text-xs text-red-600 space-y-1",children:t.contraindications.slice(0,2).map((m,N)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-1",children:"•"}),e.jsx("span",{children:m})]},N))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:l,onChange:m=>f(Math.max(1,parseInt(m.target.value)||1)),className:"w-full text-xs border border-gray-300 rounded-md py-1 px-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("button",{onClick:y,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-medium py-2 px-3 rounded-md hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Add Recommended Product"]})})]})};export{Re as P};
