import{r as d,j as e}from"./app-CkbwHOkf.js";import{B as h}from"./Button-BFsoRR4y.js";import{D as M}from"./DocusealEmbed-DHc16Xlt.js";import{u as P}from"./useManufacturers-BPT5VYH2.js";import{M as I}from"./MultiFileUpload-moHTspDX.js";import{C as b}from"./circle-alert-D5RtSiPV.js";import{A as f}from"./arrow-right-vtpcnF9X.js";import{C as w}from"./circle-check-big-BZwOB0cM.js";import"./glass-theme-CCnqi7lL.js";import"./index.esm-DpsOu67m.js";import"./Button-2TyLRw72.js";import"./index-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./card-mI4OQcp1.js";import"./utils-J8bI0sT-.js";import"./index-DNM8Gtkt.js";import"./api-CXAezOed.js";import"./loader-circle-CzGXBM_P.js";import"./createLucideIcon-HYdXrwBu.js";import"./upload-D34_G3qK.js";import"./trash-2-N2vmfG2C.js";import"./file-text-3MfHY30h.js";import"./eye-2c1yoxJs.js";import"./image-CwggCtEq.js";import"./file-BrP07e8W.js";function he({formData:r,updateFormData:c,products:m,errors:v,onNext:l}){const{manufacturers:N,loading:g,getManufacturerByName:_}=P(),[O,B]=d.useState(!1),[y,R]=d.useState(!1),[k,u]=d.useState(null),[x,p]=d.useState({}),[L,T]=d.useState(!1),[z,Y]=d.useState(0),[S,j]=d.useState(!1),C=d.useRef(null);d.useEffect(()=>{console.log("ðŸ” Step7DocuSealIVR Debug:",{formData:r,products:m,manufacturers:N,isIvrRequired:r.ivr_required,ivr_bypass_reason:r.ivr_bypass_reason,uploadedDocs:x})},[r,m,N,x]);const i=d.useMemo(()=>{var t;if(!((t=r.selected_products)!=null&&t.length))return null;const s=r.selected_products[0];return s?s.product||m.find(a=>a.id===s.product_id):null},[r.selected_products,m]),o=d.useMemo(()=>g||!(i!=null&&i.manufacturer)?null:_(i.manufacturer),[g,i==null?void 0:i.manufacturer,_]),V=o==null?void 0:o.docuseal_template_id,F=d.useMemo(()=>!(r.ivr_required===!1||r.ivr_bypass_reason),[r.ivr_required,r.ivr_bypass_reason]),q=s=>{p(t=>({...t,clinical_documents:s})),c({clinical_documents:s})},U=s=>{var a;const t=((a=x.clinical_documents)==null?void 0:a.filter(n=>n.id!==s))||[];p(n=>({...n,clinical_documents:t})),c({clinical_documents:t})},E=s=>{console.log("âœ… IVR form completed via API:",s),j(!0);const t=s.slug||s.submission_id||s.id;if(!t){console.error("âŒ No submission ID received from DocuSeal API"),u("Invalid submission response - no submission ID received"),j(!1);return}c({docuseal_submission_id:t,ivr_completed:!0,docuseal_completed_at:new Date().toISOString(),final_submission_data:s}),console.log("âœ… IVR API submission successful:",{submissionId:t,timestamp:new Date().toISOString()}),u(null),j(!1)},A=s=>{console.error("âŒ IVR form error:",s),u(s)};return d.useEffect(()=>{const s=!!(r.docuseal_submission_id&&r.ivr_completed);R(s),console.log("ðŸ” IVR Completion Check:",{docuseal_submission_id:r.docuseal_submission_id,ivr_completed:r.ivr_completed,isCompleted:s})},[r.docuseal_submission_id,r.ivr_completed]),g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading manufacturer configuration..."})]})}):i?F?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:"Insurance Verification Request (IVR)"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Complete the manufacturer's insurance verification form for ",i.name]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:y?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(w,{className:"w-16 h-16 text-green-600 dark:text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-green-900 dark:text-green-100 mb-2",children:"IVR Form Submitted Successfully!"}),e.jsxs("p",{className:"text-green-700 dark:text-green-300 mb-2",children:["Submission ID: ",r.docuseal_submission_id]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Your insurance verification request has been submitted and saved."}),e.jsxs(h,{onClick:()=>l==null?void 0:l(),className:"inline-flex items-center gap-2",children:["Continue to Final Review",e.jsx(f,{className:"w-4 h-4"})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Complete IVR Form"}),r.episode_id&&e.jsx("div",{className:"inline-flex items-center px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm rounded-full mb-4",children:"FHIR Enhanced - Pre-filled with your healthcare data"})]}),k?e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 dark:text-red-100",children:"Failed to Load IVR Form"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm mt-1",children:k})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(h,{variant:"ghost",onClick:()=>{u(null),window.location.reload()},children:"Try Again"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:C,children:e.jsx(M,{manufacturerId:String((o==null?void 0:o.id)||""),templateId:V,productCode:(i==null?void 0:i.q_code)||(i==null?void 0:i.code)||"",documentType:"IVR",formData:r,episodeId:r.episode_id?parseInt(r.episode_id):void 0,onComplete:E,onError:A,debug:!0})}),e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsx("div",{className:"flex-1",children:S?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"ðŸ”„ Processing IVR submission..."})]}):y?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:"âœ… IVR form submitted successfully via API"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 px-3 py-2 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"âš ï¸ IVR submission is required - Please complete and submit the form above"})]})})})]})]})}),v.docuseal&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-700 dark:text-red-300",children:v.docuseal})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"ðŸ“ Upload Documents (Optional)"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Upload insurance cards or clinical documents to auto-fill form fields"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-800",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"ðŸ¥ Clinical Documents"}),e.jsx(I,{title:"Upload Clinical Documents",description:"Upload clinical notes, wound photos, and other medical documentation",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",maxFiles:10,maxFileSize:10*1024*1024,onFilesChange:s=>{console.log("ðŸ“ Clinical documents uploaded:",s),q(s)},onFileRemove:s=>{console.log("ðŸ—‘ï¸ Clinical document removed:",s),U(s)},showPreview:!0})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-800",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"ðŸ‘¤ Demographics & Supporting Documents"}),e.jsx(I,{title:"Upload Demographics & Supporting Documents",description:"Upload patient demographics, face sheets, ID documents, and other supporting files",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",maxFiles:15,maxFileSize:10*1024*1024,onFilesChange:s=>{console.log("ðŸ“ Demographics and supporting documents uploaded:",s),p(t=>({...t,demographics_documents:s})),c({demographics_documents:s})},onFileRemove:s=>{var a;console.log("ðŸ—‘ï¸ Demographics file removed:",s);const t=((a=x.demographics_documents)==null?void 0:a.filter(n=>n.id!==s))||[];p(n=>({...n,demographics_documents:t})),c({demographics_documents:t})},showPreview:!0})]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:"Insurance Verification Request (IVR)"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"IVR is not required for this order"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(b,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-lg font-medium text-blue-900 dark:text-blue-100",children:"IVR Not Required"})]}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm",children:"This order does not require an Insurance Verification Request (IVR) from the manufacturer. You can still upload clinical documents and supporting files below if needed."}),r.ivr_bypass_reason&&e.jsx("div",{className:"mt-3 p-3 bg-blue-100 dark:bg-blue-800 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Reason:"})," ",r.ivr_bypass_reason]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"â„¹ï¸ IVR not required - proceeding to Order Form"})}),e.jsxs(h,{onClick:()=>l==null?void 0:l(),className:"inline-flex items-center gap-2",children:["Next",e.jsx(f,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{onClick:()=>l==null?void 0:l(),className:"inline-flex items-center gap-2",children:["Continue to Order Form",e.jsx(f,{className:"w-4 h-4"})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Product Selected"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please select a product before proceeding to the IVR step."})]})}export{he as default};
