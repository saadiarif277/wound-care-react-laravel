import{u as ee,r as x,j as e}from"./app-CkbwHOkf.js";import{M as ne,P as ce}from"./PricingDisplay-ByqrDOhf.js";import{t as U,c as G}from"./glass-theme-CCnqi7lL.js";import{P as B}from"./package-C3D73aJ6.js";import{T as re}from"./triangle-alert-D2zL4pqG.js";import{C as le}from"./circle-check-big-BZwOB0cM.js";import{X as Z}from"./x-CCCTsVjU.js";import{I as se}from"./info-BO4HO_Ur.js";import{S as de}from"./shopping-cart-m-uzUl6t.js";import{P as oe}from"./plus-BtW8yxxf.js";import{U as te}from"./users-DS-8b4bd.js";import{P as ae}from"./phone-Cep3yv4K.js";import{M as V}from"./mail-BWwpRcgy.js";import{T as me}from"./tag-CJrfyk9z.js";import{B as xe}from"./building-DoOXZ5F-.js";import{a as ue}from"./api-CXAezOed.js";import"./createLucideIcon-HYdXrwBu.js";const D=a=>{if(!a)return 0;const c=a.match(/(\d+\.?\d*)\s*[xX×]\s*(\d+\.?\d*)/);if(c){const i=parseFloat(c[1]||"0"),b=parseFloat(c[2]||"0");return i*b}const u=parseFloat(a);return!isNaN(u)&&u>0?u:0},pe=({insuranceType:a,patientState:c,woundSize:u=0,providerOnboardedProducts:i,onProductsChange:b,roleRestrictions:d,last24HourOrders:M=[],selectedProducts:T=[],className:k=""})=>{let v="dark",t=U.dark;try{v=ee().theme,t=U[v]}catch{}const[h,y]=x.useState([]),[w,z]=x.useState(!0),[f,S]=x.useState(null),[j,_]=x.useState(!1),[N,E]=x.useState(!1),[F,J]=x.useState([]),[X,o]=x.useState(null),r=x.useMemo(()=>T,[JSON.stringify(T)]),P=x.useMemo(()=>M,[JSON.stringify(M)]);x.useEffect(()=>{C()},[JSON.stringify(i),a,c,u]),x.useEffect(()=>{if(r.length>0){const s=r[0];if(s!=null&&s.product_id){const n=s.product||h.find(l=>l.id===s.product_id);S(n||null),_(!!n)}}else S(null),_(!1)},[r,h]);const q=x.useMemo(()=>({requiresConsultation:a==="medicare"&&u>450,allowedQCodes:i}),[a,u,i]),C=async()=>{try{z(!0);const s=new URLSearchParams,n=i.filter(p=>p&&p.trim()).join(",");s.append("onboarded_q_codes",n);const m=await(await fetch(`/api/products/search?${s.toString()}`)).json();m.provider_has_no_products?(o(m.message||"This provider has not been onboarded to any products yet. Please contact your MSC administrator to request product access."),y([])):(o(null),y(m.products||[]))}catch(s){console.error("Error fetching products:",s),y([])}finally{z(!1)}},$=x.useMemo(()=>!h||h.length===0?[]:i.length===0?[]:h.filter(s=>i.includes(s.q_code)),[h,i]),L=x.useMemo(()=>$.filter(()=>!0),[$]);x.useEffect(()=>{const s=[];r.forEach(n=>{var m,p;P.find(A=>{var g;return A.productCode===((g=n.product)==null?void 0:g.q_code)})&&s.push(`Warning: ${(m=n.product)==null?void 0:m.name} (${(p=n.product)==null?void 0:p.q_code}) was ordered within the last 24 hours. Please verify this is not a duplicate order.`)}),J(s)},[r,h,P]);const R=(s,n=1,l)=>{var p;const m={product_id:s.id,quantity:n,size:l,product:s};if(r.length>0&&((p=r[0])==null?void 0:p.product_id)!==s.id)b([m]);else{const A=r.findIndex(g=>g.product_id===s.id&&g.size===l);if(A>=0){const g=[...r],K=g[A];K&&(g[A]={...K,quantity:K.quantity+n,product:s},b(g))}else b([...r,m])}},Q=(s,n,l)=>{if(l<=0){O(s,n);return}const m=r.map(p=>p.product_id===s&&p.size===n?{...p,quantity:l}:p);b(m)},O=(s,n)=>{const l=r.filter(m=>!(m.product_id===s&&m.size===n));b(l)},Y=()=>{b([]),S(null),_(!1)},H=()=>r.reduce((s,n)=>{const l=n.product||h.find(p=>p.id===n.product_id);if(!l)return s;const m=l.national_asp||l.price_per_sq_cm||0;if(n.size){const p=D(n.size);if(p>0)return s+p*m*n.quantity}return s+m*n.quantity},0),W=()=>r.reduce((s,n)=>{if(n.size){const l=parseFloat(n.size);if(!isNaN(l))return s+l*n.quantity}return s},0),I=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),ie=(s,n)=>{const l=parseFloat(n);if(isNaN(l))return n;if(s.size_specific_pricing){for(const[A,g]of Object.entries(s.size_specific_pricing))if(g.area_cm2===l)return g.display_label||A}if(s.size_pricing){for(const[A,g]of Object.entries(s.size_pricing))if(g===l)return A}const m=Math.sqrt(l);return m===Math.floor(m)?`${m} x ${m} cm`:`${l} cm²`};if(w){const s=i.length===0?"Loading provider onboarded products...":"Loading product catalog...";return e.jsxs("div",{className:`flex items-center justify-center py-12 ${t.glass.card} rounded-lg ${k}`,children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:`ml-2 ${t.text.secondary}`,children:s})]})}return X&&!w?e.jsxs("div",{className:`${t.glass.card} rounded-lg p-8 text-center ${k}`,children:[e.jsx(B,{className:`w-12 h-12 mx-auto mb-3 ${t.text.muted}`}),e.jsx("h4",{className:`text-lg font-semibold ${t.text.primary} mb-2`,children:"No Products Available"}),e.jsx("p",{className:`text-sm ${t.text.secondary} mb-4`,children:X}),e.jsxs("div",{className:`${t.glass.frost} rounded-md p-3 text-left`,children:[e.jsx("h5",{className:`text-sm font-medium ${t.text.primary} mb-2`,children:"What this means:"}),e.jsxs("ul",{className:`text-xs ${t.text.secondary} space-y-1`,children:[e.jsx("li",{children:"• The provider needs to complete onboarding with manufacturers"}),e.jsx("li",{children:"• Contact your account manager to set up product access"}),e.jsx("li",{children:"• Onboarding typically includes training and agreement signatures"})]})]})]}):q.requiresConsultation?e.jsxs("div",{className:`${k}`,children:[e.jsx(fe,{woundSize:u,onContactAdmin:()=>E(!0),theme:t}),N&&e.jsx(je,{onClose:()=>E(!1),theme:t})]}):e.jsxs("div",{className:`space-y-6 ${k}`,children:[F.length>0&&e.jsx("div",{className:"space-y-2",children:F.map((s,n)=>e.jsxs("div",{className:`${t.status.warning} rounded-lg p-3 flex items-start space-x-2`,children:[e.jsx(re,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:s})]},n))}),$.length===0?e.jsxs("div",{className:`${t.glass.card} rounded-lg p-8 text-center`,children:[e.jsx(B,{className:`w-12 h-12 mx-auto mb-3 ${t.text.muted}`}),e.jsx("h4",{className:`text-lg font-semibold ${t.text.primary} mb-2`,children:"No Products Available"}),e.jsx("p",{className:`text-sm ${t.text.secondary} mb-4`,children:"No products match your insurance coverage and provider onboarding status."}),e.jsxs("div",{className:`${t.glass.frost} rounded-md p-3 text-left`,children:[e.jsx("h5",{className:`text-sm font-medium ${t.text.primary} mb-2`,children:"Possible reasons:"}),e.jsxs("ul",{className:`text-xs ${t.text.secondary} space-y-1`,children:[e.jsx("li",{children:"• Your provider is not onboarded with the insurance-approved products"}),e.jsx("li",{children:"• The wound size falls outside covered ranges"}),e.jsx("li",{children:"• State-specific Medicaid restrictions apply"})]})]})]}):e.jsxs("div",{className:"grid gap-6 grid-cols-1 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2",children:[f?e.jsx("div",{className:`mb-4 p-4 ${t.status.info} rounded-lg`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["Selected: ",f.name]}),e.jsxs("p",{className:"text-xs opacity-80",children:["Q",f.q_code," • ",f.manufacturer]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:Y,className:`inline-flex items-center px-3 py-1 text-xs font-medium rounded-md ${t.button.danger.base} ${t.button.danger.hover}`,children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Change Product"]})})]})}):e.jsxs("div",{className:`mb-4 p-3 ${t.status.info} rounded-md flex items-center`,children:[e.jsx(se,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Select one product type. You can then add multiple sizes and quantities for that product."})]}),e.jsx("div",{className:"space-y-6",children:L.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`text-sm font-semibold ${t.text.primary} mb-3 flex items-center`,children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-blue-500"}),"Available Products"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map(s=>e.jsx(he,{product:s,onAdd:R,roleRestrictions:d,isDisabled:f!==null&&f.id!==s.id,canAddMoreSizes:f!==null&&f.id===s.id,isSelected:(f==null?void 0:f.id)===s.id,theme:t},s.id))})]}):e.jsxs("div",{className:`text-center py-12 ${t.glass.frost} rounded-lg`,children:[e.jsx(B,{className:`w-12 h-12 mx-auto mb-3 ${t.text.muted}`}),e.jsx("p",{className:`${t.text.secondary} mb-2`,children:"No products available"}),e.jsx("p",{className:`text-sm ${t.text.muted}`,children:"No products match your insurance coverage or provider onboarding status."})]})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:`${t.glass.card} rounded-lg p-4 sticky top-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:`text-lg font-semibold ${t.text.primary} flex items-center`,children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),f?"Product Details":"Selected Product"]}),e.jsxs("span",{className:`text-sm ${t.text.secondary}`,children:[r.length," ",r.length===1?"size/qty":"sizes/qtys"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:`w-12 h-12 mx-auto mb-3 ${t.text.muted}`}),e.jsx("p",{className:`${t.text.secondary} mb-2`,children:"No product selected yet"}),e.jsx("p",{className:`text-xs ${t.text.muted}`,children:"Select one product type - you can add multiple sizes and quantities"})]}):e.jsxs("div",{className:"space-y-3",children:[f&&e.jsxs("div",{className:`p-3 ${t.glass.frost} rounded-md mb-4`,children:[e.jsx("h5",{className:`text-sm font-semibold ${t.text.primary} mb-1`,children:f.name}),e.jsxs("div",{className:`text-xs ${t.text.secondary} space-y-1`,children:[e.jsxs("p",{children:["Q",f.q_code," • ",f.sku]}),e.jsx("p",{children:f.manufacturer}),e.jsx("p",{className:"text-blue-600",children:f.category})]})]}),r.map(s=>{const n=s.product||h.find(p=>p.id===s.product_id);if(!n)return null;const l=n.national_asp||n.price_per_sq_cm||0;let m=0;if(s.size){const p=D(s.size);p>0?m=p*l*s.quantity:m=l*s.quantity}else m=l*s.quantity;return e.jsxs("div",{className:`border ${v==="dark"?"border-white/10":"border-gray-200"} rounded-md p-3`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex-1",children:s.size?e.jsxs("div",{children:[e.jsxs("h5",{className:`text-sm font-medium ${t.text.primary}`,children:["Size: ",ie(n,s.size)]}),e.jsxs("p",{className:`text-xs ${t.text.secondary}`,children:[s.size," cm²",d.can_see_order_totals&&` • (${s.size}) × ${I(l)}`]})]}):e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium ${t.text.primary}`,children:"Standard Size"}),d.can_see_order_totals&&e.jsxs("p",{className:`text-xs ${t.text.secondary}`,children:[I(l)," per unit"]})]})}),e.jsx("button",{onClick:()=>O(s.product_id,s.size),className:"text-red-500 hover:text-red-700",title:"Remove product",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{title:"Decrease quantity","aria-label":"Decrease quantity",onClick:()=>Q(s.product_id,s.size,s.quantity-1),className:`w-6 h-6 rounded-full border ${v==="dark"?"border-white/20 hover:bg-white/10":"border-gray-300 hover:bg-gray-50"} flex items-center justify-center`,children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx("span",{className:`text-sm font-medium ${t.text.primary} px-2`,children:s.quantity}),e.jsx("button",{title:"Increase quantity","aria-label":"Increase quantity",onClick:()=>Q(s.product_id,s.size,s.quantity+1),className:`w-6 h-6 rounded-full border ${v==="dark"?"border-white/20 hover:bg-white/10":"border-gray-300 hover:bg-gray-50"} flex items-center justify-center`,children:e.jsx(oe,{className:"w-3 h-3"})})]}),d.can_see_order_totals&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm font-semibold ${t.text.primary}`,children:I(m)}),e.jsx("p",{className:`text-xs ${t.text.secondary}`,children:s.size?`(${s.size}) × ${I(l)} × ${s.quantity}`:`${s.quantity} × ${I(l)}`})]})]})]},`${s.product_id}-${s.size||"no-size"}`)}),e.jsxs("div",{className:`border-t ${v==="dark"?"border-white/10":"border-gray-200"} pt-3 space-y-2`,children:[W()>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm font-medium ${t.text.primary}`,children:"Total Coverage:"}),e.jsxs("span",{className:`text-sm font-semibold ${t.text.primary}`,children:[W()," cm²"]})]}),d.can_see_order_totals&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-base font-semibold ${t.text.primary}`,children:"Total Price:"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:I(H())})]}),!d.can_see_msc_pricing&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"* Pricing shown is National ASP only"})]})]})]})]})})]})]})},he=({product:a,onAdd:c,roleRestrictions:u,isDisabled:i=!1,isSelected:b=!1,theme:d})=>{const[M,T]=x.useState(""),[k,v]=x.useState(1),t=()=>{c(a,k,M||void 0),v(1),T("")};return e.jsxs("div",{className:`${d.glass.card} rounded-lg p-4 transition-all duration-200 ${b?"ring-2 ring-blue-500":""} ${i?"opacity-50":""}`,children:[b&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Currently Selected"})}),e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-semibold ${d.text.primary} line-clamp-2 mb-1`,children:a.name}),e.jsxs("div",{className:`flex items-center space-x-2 text-xs ${d.text.secondary} mb-1`,children:[e.jsx(me,{className:"w-3 h-3"}),e.jsxs("span",{children:["Q",a.q_code]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:a.sku})]}),e.jsxs("div",{className:`flex items-center text-xs ${d.text.secondary}`,children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:a.manufacturer})]})]})}),e.jsx("p",{className:`text-xs ${d.text.secondary} mb-3 line-clamp-2`,children:a.description}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx(ce,{roleRestrictions:u,product:{nationalAsp:a.national_asp||a.price_per_sq_cm||0,mscPrice:a.msc_price},showLabel:!0,className:"text-xs"}),u.can_view_financials&&a.commission_rate&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:d.text.secondary,children:"Commission:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[a.commission_rate,"%"]})]})]}),a.size_options&&a.size_options.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`block text-xs font-medium ${d.text.primary} mb-1`,children:"Size"}),e.jsxs("select",{value:M,onChange:h=>T(h.target.value),className:`w-full text-xs ${d.input.base} ${d.input.focus}`,disabled:i,children:[e.jsx("option",{value:"",children:"Select size..."}),a.size_options.map(h=>{var w,z;const y=(w=a.size_specific_pricing)==null?void 0:w[h];return e.jsx("option",{value:((z=y==null?void 0:y.area_cm2)==null?void 0:z.toString())||"0",children:h},h)})]})]}):a.available_sizes&&a.available_sizes.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`block text-xs font-medium ${d.text.primary} mb-1`,children:"Size"}),e.jsxs("select",{value:M,onChange:h=>T(h.target.value),className:`w-full text-xs ${d.input.base} ${d.input.focus}`,disabled:i,children:[e.jsx("option",{value:"",children:"Select size..."}),a.available_sizes.map(h=>{const y=h.toString(),w=parseFloat(y);let z=`${w} cm²`;if(a.size_specific_pricing){for(const[f,S]of Object.entries(a.size_specific_pricing))if(S.area_cm2===w){z=S.display_label;break}}if(a.size_pricing){for(const[f,S]of Object.entries(a.size_pricing))if(S===w){z=f;break}}return e.jsx("option",{value:y,children:z},y)})]})]}):e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`block text-xs font-medium ${d.text.primary} mb-1`,children:"Size"}),e.jsx("div",{className:`text-xs ${d.text.secondary} p-2 ${d.glass.frost} rounded`,children:"No sizes available for this product. Please contact your administrator."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:`block text-xs font-medium ${d.text.primary} mb-1`,children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:k,onChange:h=>v(Math.max(1,parseInt(h.target.value)||1)),className:`w-full text-xs ${d.input.base} ${d.input.focus}`,disabled:i})]}),e.jsx("button",{onClick:t,disabled:(a.size_options&&a.size_options.length>0||a.available_sizes&&a.available_sizes.length>0)&&!M||i,className:`w-full text-sm font-medium py-2 px-3 rounded-md transition-all duration-200 ${i?"bg-gray-300 text-gray-500 cursor-not-allowed":`${d.button.primary.base} ${d.button.primary.hover}`}`,children:i?"Different Product Selected":b?"Add Another Size":"Select This Product"})]})},fe=({woundSize:a,onContactAdmin:c,theme:u})=>e.jsx("div",{className:`${u.glass.card} rounded-lg p-6`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-full mb-4",children:e.jsx(te,{className:"w-8 h-8 text-yellow-600"})}),e.jsx("h3",{className:`text-xl font-semibold ${u.text.primary} mb-2`,children:"Consultation Required"}),e.jsx("p",{className:`text-sm ${u.text.secondary} mb-4`,children:"Medicare requires special consultation for wounds larger than 450 sq cm."}),e.jsx("div",{className:`${u.glass.frost} rounded-md p-4 mb-6`,children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:u.text.secondary,children:"Current wound size:"}),e.jsxs("span",{className:`font-semibold ${u.text.primary}`,children:[a," sq cm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:u.text.secondary,children:"Medicare limit:"}),e.jsx("span",{className:`font-semibold ${u.text.primary}`,children:"450 sq cm"})]})]})}),e.jsx("p",{className:`text-xs ${u.text.tertiary} mb-6`,children:"Please contact MSC Admin for assistance with this order. They will help coordinate the necessary approvals and documentation."}),e.jsxs("button",{onClick:c,className:`inline-flex items-center px-6 py-3 ${u.button.primary.base} ${u.button.primary.hover} rounded-lg text-sm font-medium`,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Contact MSC Admin"]})]})}),je=({onClose:a,theme:c})=>e.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center p-4 ${c.modal.backdrop}`,children:e.jsxs("div",{className:`${c.modal.container} max-w-md w-full`,children:[e.jsx("div",{className:c.modal.header,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`text-lg font-semibold ${c.text.primary}`,children:"Contact MSC Admin"}),e.jsx("button",{type:"button",title:"Close",onClick:a,className:`${c.text.secondary} hover:${c.text.primary}`,children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:c.modal.body,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4",children:e.jsx(V,{className:"w-8 h-8 text-blue-600"})}),e.jsx("p",{className:`text-sm ${c.text.secondary}`,children:"Please reach out to MSC for assistance with Medicare orders exceeding 450 sq cm."})]}),e.jsxs("div",{className:`${c.glass.frost} rounded-lg p-4 space-y-3`,children:[e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-semibold ${c.text.primary} mb-1`,children:"Contact Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(te,{className:`w-4 h-4 mr-2 ${c.text.tertiary}`}),e.jsx("span",{className:c.text.secondary,children:"Ashley (MSC Admin)"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(V,{className:`w-4 h-4 mr-2 ${c.text.tertiary}`}),e.jsx("a",{href:"mailto:admin@mscwoundcare.com",className:"text-blue-600 hover:underline",children:"admin@mscwoundcare.com"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${c.text.tertiary}`}),e.jsx("span",{className:c.text.secondary,children:"Contact MSC Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-semibold ${c.text.primary} mb-1`,children:"What to Include"}),e.jsxs("ul",{className:`text-xs ${c.text.secondary} space-y-1`,children:[e.jsx("li",{children:"• Patient information and wound details"}),e.jsx("li",{children:"• Clinical documentation supporting the wound size"}),e.jsx("li",{children:"• Proposed treatment plan"}),e.jsx("li",{children:"• Any previous treatment history"})]})]})]}),e.jsx("div",{className:`p-3 ${c.status.info} rounded-md`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(se,{className:"w-4 h-4 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs",children:"MSC Admin will review your request and coordinate with Medicare to ensure proper authorization and reimbursement."})]})})]})}),e.jsx("div",{className:c.modal.footer,children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:a,className:`px-4 py-2 text-sm font-medium rounded-md ${c.button.ghost.base} ${c.button.ghost.hover}`,children:"Close"}),e.jsxs("a",{href:"mailto:admin@mscwoundcare.com?subject=Medicare Consultation Request - Wound >450 sq cm",className:`inline-flex items-center px-4 py-2 text-sm font-medium rounded-md ${c.button.primary.base} ${c.button.primary.hover}`,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Send Email"]})]})})]})});function Ee({formData:a,updateFormData:c,errors:u,currentUser:i,roleRestrictions:b,onStepComplete:d}){const[M,T]=x.useState([]),[k,v]=x.useState(!1),[t,h]=x.useState(null);let y="dark";try{y=ee().theme}catch{}x.useEffect(()=>{const j=(i==null?void 0:i.role)||"unknown",_={can_view_financials:["admin","super_admin","sales_rep","provider"].includes(j),can_see_discounts:["admin","super_admin","sales_rep"].includes(j),can_see_msc_pricing:["admin","super_admin","sales_rep","provider"].includes(j),can_see_order_totals:["admin","super_admin","sales_rep","provider"].includes(j),pricing_access_level:["admin","super_admin"].includes(j)?"full":["sales_rep"].includes(j)?"limited":"none",commission_access_level:["admin","super_admin","sales_rep"].includes(j)?"full":"none"};h(_),console.log("✅ User permissions computed from props:",{role:j,permissions:_})},[i==null?void 0:i.role]),x.useEffect(()=>{var j,_,N,E,F,J;if(d){const X={products:{selected_products:a.selected_products||[],product_details:((j=a.selected_products)==null?void 0:j.map(o=>{var r,P,q,C,$,L,R,Q,O,Y,H,W;return{product_id:o.product_id,quantity:o.quantity,size:o.size,product:o.product,price:((r=o.product)==null?void 0:r.price)||((P=o.product)==null?void 0:P.discounted_price)||((q=o.product)==null?void 0:q.unit_price)||0,total_price:(((C=o.product)==null?void 0:C.price)||(($=o.product)==null?void 0:$.discounted_price)||((L=o.product)==null?void 0:L.unit_price)||0)*o.quantity,finalized_price:((R=o.product)==null?void 0:R.price)||((Q=o.product)==null?void 0:Q.discounted_price)||((O=o.product)==null?void 0:O.unit_price)||0,finalized_total:(((Y=o.product)==null?void 0:Y.price)||((H=o.product)==null?void 0:H.discounted_price)||((W=o.product)==null?void 0:W.unit_price)||0)*o.quantity}}))||[],total_quantity:((_=a.selected_products)==null?void 0:_.reduce((o,r)=>o+(r.quantity||0),0))||0,total_value:((N=a.selected_products)==null?void 0:N.reduce((o,r)=>{var q,C,$;const P=((q=r.product)==null?void 0:q.price)||((C=r.product)==null?void 0:C.discounted_price)||(($=r.product)==null?void 0:$.unit_price)||0;return o+P*r.quantity},0))||0},pricing:{can_view_financials:(t==null?void 0:t.can_view_financials)||!1,can_see_discounts:(t==null?void 0:t.can_see_discounts)||!1,can_see_msc_pricing:(t==null?void 0:t.can_see_msc_pricing)||!1,can_see_order_totals:(t==null?void 0:t.can_see_order_totals)||!1,pricing_access_level:(t==null?void 0:t.pricing_access_level)||"none",commission_access_level:(t==null?void 0:t.commission_access_level)||"none",total_amount:((E=a.selected_products)==null?void 0:E.reduce((o,r)=>{var q,C,$;const P=((q=r.product)==null?void 0:q.price)||((C=r.product)==null?void 0:C.discounted_price)||(($=r.product)==null?void 0:$.unit_price)||0;return o+P*r.quantity},0))||0,total_quantity:((F=a.selected_products)==null?void 0:F.reduce((o,r)=>o+(r.quantity||0),0))||0,product_count:((J=a.selected_products)==null?void 0:J.length)||0}};d(X)}},[a.selected_products,t,d]),x.useEffect(()=>{(async()=>{let _=a.provider_id;if(!_&&(i==null?void 0:i.role)==="provider"&&(i!=null&&i.id)&&(_=i.id),_){v(!0);try{const N=await ue.get(`/api/v1/providers/${_}/onboarded-products`);N.success&&T(N.q_codes||[])}catch(N){console.error("Error fetching provider products:",N)}finally{v(!1)}}})()},[a.provider_id,i==null?void 0:i.id,i==null?void 0:i.role]);const w=x.useCallback(async j=>{const _=j.map(N=>({...N,provider_id:a.provider_id,size:N.size?String(N.size).replace(/\s*([xX×^])\s*/g," x "):void 0}));c({selected_products:_}),console.log("✅ Products selected, episode will be created during submission:",_.length)},[a.provider_id,a.episode_id,c]),z=x.useMemo(()=>t||b||{can_view_financials:!1,can_see_discounts:!1,can_see_msc_pricing:!1,can_see_order_totals:!1,pricing_access_level:"none",commission_access_level:"none"},[t,b]),f=x.useMemo(()=>{var N,E;const j=((N=a.primary_insurance_name)==null?void 0:N.toLowerCase())||"",_=((E=a.primary_plan_type)==null?void 0:E.toLowerCase())||"";return j.includes("medicare")?"medicare":j.includes("medicaid")?"medicaid":_==="ppo"||_==="commercial"?"ppo":"commercial"},[a.primary_insurance_name,a.primary_plan_type]),S=x.useMemo(()=>parseFloat(a.wound_size_length||"0")*parseFloat(a.wound_size_width||"0"),[a.wound_size_length,a.wound_size_width]);return e.jsxs("div",{className:"space-y-6",children:[k&&a.provider_id?e.jsxs("div",{className:G("p-8 text-center rounded-lg",y==="dark"?"bg-gray-800":"bg-gray-100"),children:[e.jsx("div",{className:"w-6 h-6 border-2 border-current border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:G("text-sm",y==="dark"?"text-gray-400":"text-gray-600"),children:"Loading provider products..."})]}):e.jsx(pe,{providerOnboardedProducts:M,insuranceType:f,woundSize:S,patientState:a.patient_state,roleRestrictions:z,last24HourOrders:a.last_24_hour_orders||[],selectedProducts:a.selected_products||[],onProductsChange:w,className:""}),u.products&&e.jsx("div",{className:G("p-4 rounded-lg border",y==="dark"?"bg-red-900/20 border-red-800":"bg-red-50 border-red-200"),children:e.jsx("p",{className:G("text-sm",y==="dark"?"text-red-400":"text-red-600"),children:u.products})})]})}export{Ee as default};
