import{r as _,A as Q,c as X,j as i}from"./app-CkbwHOkf.js";import{B as Z}from"./Button-BFsoRR4y.js";import{u as E}from"./use-toast-dw3sZCYt.js";import{PatientInsuranceSection as a}from"./PatientInsuranceSection-Mz7O9Dx1.js";import{ProductSection as f}from"./ProductSection-Wd8T6zjo.js";import{FormsSection as D}from"./FormsSection-DAvzsVkm.js";import{ClinicalSection as ee}from"./ClinicalSection-Cst4aCSu.js";import{ProviderSection as ie}from"./ProviderSection-ClYYolJe.js";import{SubmissionSection as se}from"./SubmissionSection-_9KI9pXe.js";import{OrderModals as ne}from"./OrderModals-DvAZ94e8.js";import{OrderDashboard as te}from"./OrderDashboard-DEa8GFb3.js";import"./glass-theme-CCnqi7lL.js";import"./SectionCard-DXpRq2Tu.js";import"./card-I35nyvuT.js";import"./utils-J8bI0sT-.js";import"./clsx-B-dksMZM.js";import"./collapsible-BfCXG3XD.js";import"./index-DdQWWdLt.js";import"./index-DW48STyt.js";import"./index-CD7V_8Mq.js";import"./index-De90F09_.js";import"./index-BsB1_LdS.js";import"./index-COQ4n3Z8.js";import"./index-BrKfa2YN.js";import"./index-CHViK9kl.js";import"./index-CHrZSOeV.js";import"./chevron-up-CAFyUi5R.js";import"./createLucideIcon-HYdXrwBu.js";import"./chevron-down-BQSbFUOw.js";import"./InfoRow-Cw2QKNb8.js";import"./user-CeKBNj6z.js";import"./calendar-CU3MSIjO.js";import"./phone-Cep3yv4K.js";import"./mail-BWwpRcgy.js";import"./map-pin-DGRcBcWO.js";import"./shield-DtxW4kzs.js";import"./credit-card-DRvf_b2i.js";import"./package-C3D73aJ6.js";import"./dollar-sign-BlJ6QvEN.js";import"./button-C66gPLL8.js";import"./index-Dp3B9jqt.js";import"./clipboard-list-BnIYJfVx.js";import"./file-text-3MfHY30h.js";import"./eye-2c1yoxJs.js";import"./heart-DxydAzba.js";import"./ruler-C48CsleA.js";import"./textarea-BSEHvHdh.js";import"./index-CrDEJIod.js";import"./index-CJDEk-ke.js";import"./index-B72oRj5t.js";import"./index-tOmcRMfK.js";import"./tslib.es6-BUas5LQb.js";import"./index-B0a07vTj.js";import"./x-CCCTsVjU.js";import"./OrderTable-CjP9DClI.js";import"./table-CaoNgQkM.js";import"./badge-DOWam2H5.js";import"./OrderDetailView-SJw2IqG4.js";import"./AdminActionModals-BKTxEFa9.js";import"./dialog-O7b9FzWe.js";import"./textarea-BV2KGveZ.js";import"./radio-group-DjjV71Ir.js";import"./index-CHZlhBx2.js";import"./index-CGM15_wX.js";import"./index-Dhr0tlRy.js";import"./index-BDWjCInz.js";import"./index-DH46q2It.js";import"./circle-Z99kmwI8.js";import"./label-DW5qsXOm.js";import"./select-AyH6fXRt.js";import"./index-BdQq_4o_.js";import"./index-PMIrgxBe.js";import"./floating-ui.dom-D8L_YZte.js";import"./index-BT8fXH-3.js";import"./check-DXIgFk-v.js";import"./IVRSection-hBHu0Vzs.js";import"./upload-D34_G3qK.js";import"./OrderFormSection-BE_3vTBO.js";import"./arrow-left-CnUTEFlg.js";import"./building-2-By7SiNBb.js";import"./stethoscope-DH_Dpbte.js";import"./plus-BtW8yxxf.js";const re=(y,x)=>{const[g,z]=_.useState("Provider"),[o,l]=_.useState({patient:!0,provider:!0,clinical:!0,product:!0,forms:!0,submission:!0}),[F,w]=_.useState(!1),[P,v]=_.useState(!1),[k,j]=_.useState(!1),[C,I]=_.useState(!1),[N,T]=_.useState(""),[S,R]=_.useState(!1),{toast:h}=E(),$=t=>{l(u=>({...u,[t]:!u[t]}))},M=()=>y.information_accurate&&y.maintain_documentation&&y.authorize_prior_auth;return{userRole:g,setUserRole:z,openSections:o,toggleSection:$,showSubmitModal:F,setShowSubmitModal:w,showSuccessModal:P,setShowSuccessModal:v,showNoteModal:k,setShowNoteModal:j,confirmationChecked:C,setConfirmationChecked:I,adminNote:N,setAdminNote:T,orderSubmitted:S,isOrderComplete:M,handleSubmitOrder:()=>{if(!M()){h({title:"Order Incomplete",description:"Please confirm all declarations in the submission section before submitting.",variant:"destructive"});return}w(!0)},confirmSubmission:async()=>{var t,u,O,m;if(!C){h({title:"Confirmation Required",description:"Please confirm that the information is accurate and complete.",variant:"destructive"});return}try{const s={...y};["patient_first_name","patient_last_name","patient_dob","patient_gender","patient_member_id","patient_address_line1","patient_address_line2","patient_city","patient_state","patient_zip","patient_phone","patient_email","provider_first_name","provider_last_name","provider_npi","provider_ptan","provider_credentials","facility_name","facility_npi","facility_ptan","facility_address_line1","facility_address_line2","facility_city","facility_state","facility_zip","facility_phone","wound_type","wound_size_length","wound_size_width","wound_size_depth","wound_duration","diagnosis_codes","place_of_service","primary_insurance_payer","primary_insurance_plan","primary_insurance_policy","secondary_insurance_payer","secondary_insurance_plan","secondary_insurance_policy","request_type","information_accurate","maintain_documentation","authorize_prior_auth"].forEach(d=>{s[d]!==void 0&&s[d]!==null?s[d]=String(s[d]).trim():s[d]=""}),Array.isArray(s.selected_products)||(s.selected_products=[]),Array.isArray(s.diagnosis_codes)||(s.diagnosis_codes=[]);const c=N?String(N).trim():"No admin note provided";console.log("Submitting order with cleaned formData:",s),console.log("Submitting order with episodeData:",x),console.log("Admin note value:",N),console.log("Safe admin note:",c);const b=await X.post("/quick-requests/submit-order",{formData:s,episodeData:x,adminNote:c});b.data.success?(w(!1),R(!0),v(!0)):h({title:"Submission Failed",description:b.data.message,variant:"destructive"})}catch(s){console.error("Order submission error:",s),console.error("Error response data:",(t=s.response)==null?void 0:t.data);let p="An unexpected error occurred.";if(((u=s.response)==null?void 0:u.status)===422){const c=s.response.data.errors;c&&typeof c=="object"?p=`Validation errors:
${Object.entries(c).map(([d,A])=>`${d}: ${Array.isArray(A)?A.join(", "):A}`).join(`
`)}`:p=s.response.data.message||"Please check your form data and try again."}else(m=(O=s.response)==null?void 0:O.data)!=null&&m.message?p=s.response.data.message:s.message&&(p=s.message);h({title:"Submission Failed",description:p,variant:"destructive"})}},handleAddNote:()=>{v(!1),j(!0)},finishSubmission:()=>{j(!1),h({title:"Order Submitted Successfully",description:"Your order has been submitted for admin review."}),Q.get("/dashboard")}}},Ri=({formData:y,validatedEpisodeData:x})=>{const{userRole:g,setUserRole:z,openSections:o,toggleSection:l,showSubmitModal:F,setShowSubmitModal:w,showSuccessModal:P,setShowSuccessModal:v,showNoteModal:k,setShowNoteModal:j,confirmationChecked:C,setConfirmationChecked:I,adminNote:N,setAdminNote:T,orderSubmitted:S,isOrderComplete:R,handleSubmitOrder:h,confirmSubmission:$,handleAddNote:M,finishSubmission:q}=re(y,x),r=((e,t)=>{var u,O,m,s,p,c,b,d,A,B,L,V,U,W,Y,G,H,J;return{orderNumber:(t==null?void 0:t.episode_id)||(e==null?void 0:e.episode_id)||"N/A",orderStatus:(e==null?void 0:e.order_status)||"draft",createdDate:e!=null&&e.created_at?new Date(e.created_at).toLocaleDateString():new Date().toLocaleDateString(),createdBy:(e==null?void 0:e.provider_name)||"N/A",patient:{fullName:`${(e==null?void 0:e.patient_first_name)||""} ${(e==null?void 0:e.patient_last_name)||""}`.trim()||"N/A",dateOfBirth:(e==null?void 0:e.patient_dob)||"N/A",phone:(e==null?void 0:e.patient_phone)||"N/A",email:(e==null?void 0:e.patient_email)||"N/A",address:(e==null?void 0:e.patient_address)||"N/A",displayId:(e==null?void 0:e.patient_display_id)||(t==null?void 0:t.patient_display_id)||"N/A",primaryInsurance:{payerName:(e==null?void 0:e.primary_insurance_name)||"N/A",planName:(e==null?void 0:e.primary_plan_type)||"N/A",policyNumber:(e==null?void 0:e.primary_member_id)||"N/A"},secondaryInsurance:e!=null&&e.has_secondary_insurance?{payerName:(e==null?void 0:e.secondary_insurance_name)||"N/A",planName:(e==null?void 0:e.secondary_plan_type)||"N/A",policyNumber:(e==null?void 0:e.secondary_member_id)||"N/A"}:null,insuranceCardUploaded:!!(e!=null&&e.insurance_card_front)},provider:{name:(e==null?void 0:e.provider_name)||"N/A",facilityName:(e==null?void 0:e.facility_name)||((u=e==null?void 0:e.facility)==null?void 0:u.name)||"N/A",facilityAddress:(e==null?void 0:e.facility_address)||((m=(O=e==null?void 0:e.facility)==null?void 0:O.address)==null?void 0:m.line1)||(e==null?void 0:e.service_address)||"N/A",organization:(e==null?void 0:e.organization_name)||"N/A",npi:(e==null?void 0:e.provider_npi)||"N/A"},clinical:{woundType:(e==null?void 0:e.wound_type)||"N/A",woundSize:e!=null&&e.wound_size_length&&(e!=null&&e.wound_size_width)?`${e.wound_size_length} x ${e.wound_size_width}cm`:"N/A",diagnosisCodes:Array.isArray(e==null?void 0:e.diagnosis_codes)?e.diagnosis_codes.map(n=>({code:typeof n=="string"?n:(n==null?void 0:n.code)||"N/A",description:typeof n=="object"&&(n==null?void 0:n.description)||"N/A"})):[],icd10Codes:Array.isArray(e==null?void 0:e.icd10_codes)?e.icd10_codes.map(n=>({code:typeof n=="string"?n:(n==null?void 0:n.code)||"N/A",description:typeof n=="object"&&(n==null?void 0:n.description)||"N/A"})):[],procedureInfo:(e==null?void 0:e.procedure_info)||"N/A",priorApplications:parseInt(e==null?void 0:e.prior_applications)||0,anticipatedApplications:parseInt(e==null?void 0:e.anticipated_applications)||0,facilityInfo:(e==null?void 0:e.facility_name)||"N/A"},product:{name:((c=(p=(s=e==null?void 0:e.selected_products)==null?void 0:s[0])==null?void 0:p.product)==null?void 0:c.name)||"N/A",sizes:((b=e==null?void 0:e.selected_products)==null?void 0:b.map(n=>(n==null?void 0:n.size)||"Standard"))||["N/A"],quantity:parseInt((A=(d=e==null?void 0:e.selected_products)==null?void 0:d[0])==null?void 0:A.quantity)||1,aspPrice:parseFloat((V=(L=(B=e==null?void 0:e.selected_products)==null?void 0:B[0])==null?void 0:L.product)==null?void 0:V.price)||0,discountedPrice:parseFloat((Y=(W=(U=e==null?void 0:e.selected_products)==null?void 0:U[0])==null?void 0:W.product)==null?void 0:Y.discounted_price)||parseFloat((J=(H=(G=e==null?void 0:e.selected_products)==null?void 0:G[0])==null?void 0:H.product)==null?void 0:J.price)||0,coverageWarnings:(e==null?void 0:e.coverage_warnings)||[]},ivrForm:{status:e!=null&&e.docuseal_submission_id?"Completed":"Not Started",submissionDate:(e==null?void 0:e.ivr_completed_at)||"N/A",documentLink:(e==null?void 0:e.ivr_document_link)||""},orderForm:{status:(e==null?void 0:e.order_form_status)||"Not Sent",submissionDate:(e==null?void 0:e.order_form_completed_at)||"N/A",documentLink:(e==null?void 0:e.order_form_link)||""}}})(y,x);return g==="Admin"?i.jsx(te,{}):i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:i.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[i.jsxs("div",{className:"flex justify-between items-start mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:S?"Order Details":"Order Review & Summary"}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[i.jsxs("span",{children:["Order #",r.orderNumber]}),i.jsx("span",{children:"•"}),i.jsxs("span",{children:["Created ",r.createdDate]}),i.jsx("span",{children:"•"}),i.jsxs("span",{children:["By ",r.createdBy]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("select",{value:g,onChange:e=>z(e.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[i.jsx("option",{value:"Provider",children:"Provider View"}),i.jsx("option",{value:"OM",children:"Order Manager View"}),i.jsx("option",{value:"Admin",children:"Admin View"})]}),i.jsx("div",{className:"text-sm px-3 py-1 border rounded-md bg-muted/50",children:S?"Pending Review":"Draft"})]})]}),i.jsx(a,{orderData:r,isOpen:o.patient,onToggle:l}),i.jsx(f,{orderData:r,userRole:g,isOpen:o.product,onToggle:l}),i.jsx(D,{orderData:r,isOpen:o.forms,onToggle:l}),i.jsx(ee,{orderData:r,isOpen:o.clinical,onToggle:l}),i.jsx(ie,{orderData:r,isOpen:o.provider,onToggle:l}),i.jsx(se,{orderData:r,userRole:g,orderSubmitted:S,isOpen:o.submission,onToggle:l}),!S&&i.jsx("div",{className:"flex justify-center mt-8",children:i.jsx(Z,{onClick:h,disabled:!R(),className:"bg-primary hover:bg-primary/90 text-primary-foreground px-8 py-2",children:"Submit Order"})}),i.jsx(ne,{showSubmitModal:F,showSuccessModal:P,showNoteModal:k,confirmationChecked:C,adminNote:N,onSubmitModalChange:w,onSuccessModalChange:v,onNoteModalChange:j,onConfirmationChange:I,onAdminNoteChange:T,onConfirmSubmission:$,onAddNote:M,onFinishSubmission:q})]})})};export{Ri as default};
