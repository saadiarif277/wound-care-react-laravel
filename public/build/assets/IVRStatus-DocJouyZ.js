import{r as s,j as e,S as T,x as A,A as B}from"./app-CkbwHOkf.js";import{M as F}from"./MainLayout-DIjIBnGe.js";import{C as i}from"./card-mI4OQcp1.js";import{B as l}from"./badge-ATX-lA6w.js";import{T as f}from"./triangle-alert-D2zL4pqG.js";import{S as M}from"./search-B4qCXP-m.js";import{F as R}from"./filter-CvtIixAT.js";import{F as V}from"./file-text-3MfHY30h.js";import{U as I}from"./user-CeKBNj6z.js";import{C as P}from"./chevron-right-BB6IVksD.js";import{B as U}from"./building-2-By7SiNBb.js";import{D as q}from"./download-Dw1sq69C.js";import{C as j}from"./clock-BCNbb55_.js";import{C as L}from"./circle-check-big-BZwOB0cM.js";import{R as O}from"./refresh-cw-gQ0DW4pt.js";import"./glass-theme-CCnqi7lL.js";import"./x-CCCTsVjU.js";import"./createLucideIcon-HYdXrwBu.js";import"./check-DXIgFk-v.js";import"./index-R2fUhcwH.js";function xe({patientIVRs:o,expiringIVRs:n,filters:d,manufacturers:N,patientId:k}){const[c,w]=s.useState(d.search||""),[x,v]=s.useState(d.status||""),[m,_]=s.useState(d.manufacturer||""),[g,h]=s.useState(d.expiring_soon||!1),[$,Q]=s.useState([]),p=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never",S=r=>r?Math.ceil((new Date(r).getTime()-new Date().getTime())/(1e3*60*60*24)):null,C=r=>{const a=S(r.expiration_date);return r.status==="expired"||a!==null&&a<0?e.jsxs(l,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Expired"]}):a!==null&&a<=30?e.jsxs(l,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Expires in ",a," days"]}):r.status==="active"?e.jsxs(l,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsxs(l,{className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Pending"]})},E=r=>{const t={weekly:{label:"Weekly",color:"purple"},monthly:{label:"Monthly",color:"blue"},quarterly:{label:"Quarterly",color:"green"},yearly:{label:"Yearly",color:"gray"}}[r]||{label:r,color:"gray"};return e.jsxs(l,{variant:"outline",className:`border-${t.color}-300 text-${t.color}-700`,children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),t.label]})},D=r=>{r.preventDefault(),B.get(window.location.pathname,{search:c,status:x,manufacturer:m,expiring_soon:g})},u=s.useMemo(()=>{const r={};return o.forEach(a=>{const t=a.patient_fhir_id;r[t]||(r[t]=[]),r[t].push(a)}),Object.entries(r).map(([a,t])=>({patient_fhir_id:a,patient_name:t[0].patient_name,patient_display_id:t[0].patient_display_id,ivrs:t.sort((y,b)=>y.expiration_date?b.expiration_date?new Date(y.expiration_date).getTime()-new Date(b.expiration_date).getTime():1:-1)}))},[o]);return s.useEffect(()=>{},[k]),e.jsxs(F,{children:[e.jsx(T,{title:"Patient IVR Status"}),e.jsxs("div",{className:"w-full min-h-screen bg-gray-50 dark:bg-gray-900 py-4 px-2 sm:px-4 md:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Patient IVR Status"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Track IVR verification status by patient and manufacturer"})]}),n.length>0&&e.jsx(i,{className:"mb-6 p-4 bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(f,{className:"w-5 h-5 text-orange-600 dark:text-orange-300 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-sm font-medium text-orange-900 dark:text-orange-100",children:[n.length," IVR",n.length===1?"":"s"," Expiring Soon"]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-200 mt-1",children:"These IVRs will expire within the next 30 days and need to be renewed."}),e.jsxs("div",{className:"mt-3 space-y-2",children:[n.slice(0,3).map(r=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-orange-900 dark:text-orange-100",children:r.patient_name}),e.jsxs("span",{className:"text-orange-700 dark:text-orange-200",children:[" ","• ",r.manufacturer.name," • Expires ",p(r.expiration_date)]})]},r.id)),n.length>3&&e.jsxs("button",{onClick:()=>h(!0),className:"text-sm text-orange-600 dark:text-orange-300 hover:text-orange-800 dark:hover:text-orange-100",children:["View all ",n.length," expiring IVRs →"]})]})]})]})}),e.jsx(i,{className:"p-4 mb-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:e.jsxs("form",{onSubmit:D,className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-5 h-5"}),e.jsx("input",{type:"text",value:c,onChange:r=>w(r.target.value),placeholder:"Search patients...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-900 dark:text-white dark:placeholder-gray-400"})]}),e.jsxs("select",{"aria-label":"Filter by status",value:x,onChange:r=>v(r.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"pending",children:"Pending"})]}),e.jsxs("select",{"aria-label":"Filter by manufacturer",value:m,onChange:r=>_(r.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"All Manufacturers"}),N.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:r=>h(r.target.checked),className:"rounded border-gray-300 dark:border-gray-700 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-200",children:"Expiring Soon Only"})]}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Apply Filters"]})]})}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs(i,{className:"p-8 text-center bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsx(V,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:"No patient IVR records found"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"IVR records will appear here as orders are processed"})]}):u.map(r=>e.jsxs(i,{className:"p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(I,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:r.patient_name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:["ID: ",r.patient_display_id]})]})]}),e.jsxs(A,{href:`/admin/patients/${r.patient_fhir_id}/orders`,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 flex items-center gap-1",children:["View Orders",e.jsx(P,{className:"w-4 h-4"})]})]})}),e.jsx("div",{className:"space-y-3",children:r.ivrs.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.manufacturer.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-300",children:["Last Verified: ",p(a.last_verified_date)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[E(a.frequency),C(a),a.latest_docuseal_submission_id&&e.jsx("button",{className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",title:"Download IVR Document",children:e.jsx(q,{className:"w-4 h-4"})})]})]},a.id))})]},r.patient_fhir_id))})]})]})}export{xe as default};
