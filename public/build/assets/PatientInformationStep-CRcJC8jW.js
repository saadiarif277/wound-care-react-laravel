import{r as o,j as e}from"./app-b7vnQlZc.js";import{v as $,g as L,u as M}from"./index-DpA9ZXCS.js";import{E as B}from"./EcwConnection-D0wFtcIZ.js";const P="/api/v1";class O{constructor(){}transformECWApiResponseToFormData(a){return console.log("Transforming ECW API response to FormData:",a),a}async importPatientData(a){const i=await fetch(`${P}/ecw/patient/${a}`,{headers:{Accept:"application/json"}});if(!i.ok){const n=await i.json().catch(()=>({message:i.statusText}));throw new Error(`API error importing patient data from ECW: ${n.message||i.statusText}`)}const l=await i.json();return this.transformECWApiResponseToFormData(l)}extractWoundAssessmentDataFromApiResponse(a){return console.log("Extracting wound assessment data from ECW API response:",a),a}async importClinicalDocumentation(a){const i=await fetch(`${P}/ecw/patient/${a}/documents?documentType=wound-assessment`,{headers:{Accept:"application/json"}});if(!i.ok){const n=await i.json().catch(()=>({message:i.statusText}));throw new Error(`API error importing clinical documentation from ECW: ${n.message||i.statusText}`)}const l=await i.json();return this.extractWoundAssessmentDataFromApiResponse(l)}transformECWSearchApiResponseToPatientFormDataArray(a){var l;return console.log("Transforming ECW search API response to PatientFormData[]:",a),(((l=a==null?void 0:a.entry)==null?void 0:l.map(n=>n.resource))||a||[]).map(n=>{var u,c,v,h,g,p,w,f,y;return{first_name:((v=(c=(u=n.name)==null?void 0:u[0])==null?void 0:c.given)==null?void 0:v[0])||"",last_name:((g=(h=n.name)==null?void 0:h[0])==null?void 0:g.family)||"",dob:n.birthDate||"",member_id:((w=(p=n.identifier)==null?void 0:p.find(_=>_.system==="urn:oid:2.16.840.1.113883.3.4"))==null?void 0:w.value)||((y=(f=n.identifier)==null?void 0:f[0])==null?void 0:y.value)||"",gender:n.gender||"",id:n.id}})}async searchPatientsByName(a){const i=await fetch(`${P}/ecw/patients/search?name=${encodeURIComponent(a)}`,{headers:{Accept:"application/fhir+json","X-Requested-With":"XMLHttpRequest"}});if(!i.ok){const n=await i.json().catch(()=>({message:i.statusText}));throw new Error(`API error searching patients in ECW: ${n.message||i.statusText}`)}const l=await i.json();return this.transformECWSearchApiResponseToPatientFormDataArray(l)}}const H=({formData:t,updateFormData:a,woundTypes:i,facilities:l})=>{const[n,u]=o.useState(!1),[c,v]=o.useState(""),[h,g]=o.useState([]),[p,w]=o.useState(null),[f,y]=o.useState([]),[_,C]=o.useState(!1),[j,m]=o.useState(null),W=new O,b=s=>{a({patient_api_input:{...t.patient_api_input,...s}})},T=async()=>{if(!c.trim()){g([]);return}try{C(!0),m(null);const d=(await W.searchPatientsByName(c)).map(r=>({...r,gender:r.gender}));g(d)}catch(s){m(s.message||"Failed to search patients"),console.error("Patient search failed:",s),s.message&&s.message.includes("401")&&u(!1)}finally{C(!1)}},D=async s=>{var d;try{C(!0),m(null);const r=await fetch(`/api/ecw/patients/${s}/conditions`,{headers:{Accept:"application/fhir+json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok){const x=await r.json().catch(()=>({message:"Failed to fetch conditions, server response unreadable"}));throw new Error(x.message||`Failed to fetch conditions. Status: ${r.status}`)}const k=await r.json();y(((d=k.entry)==null?void 0:d.map(x=>x.resource))||[])}catch(r){m(r.message||"Failed to fetch patient conditions"),console.error("Conditions fetch failed:",r)}finally{C(!1)}},R=async s=>{w(s),a({patient_api_input:s}),s.id?await D(s.id):(console.warn("Selected patient does not have an ID to fetch conditions."),y([]))},N=(s,d)=>{a({[s]:d})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Patient Information"}),e.jsx("div",{className:"mt-4",children:e.jsx(B,{onConnectionChange:u})}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("input",{type:"text",value:c,onChange:s=>v(s.target.value),placeholder:"Search patient by name...",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})}),e.jsxs("button",{type:"button",onClick:T,disabled:_,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[_?e.jsx($,{className:"animate-spin h-5 w-5"}):e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{className:"ml-2",children:"Search"})]})]}),h.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Search Results"}),e.jsx("ul",{className:"mt-2 divide-y divide-gray-200",children:h.map((s,d)=>e.jsxs("li",{className:"py-3 flex justify-between items-center hover:bg-gray-50 cursor-pointer",onClick:()=>R(s),children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["DOB: ",s.dob," ",s.member_id?`â€¢ ID: ${s.member_id}`:""]})]}),e.jsx("button",{type:"button",className:"ml-4 inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200",children:"Select"})]},s.id||d))})]}),j&&e.jsx("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(M,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:j})})]})]})})]}),p&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Selected Patient Details"}),e.jsx("div",{className:"mt-2 bg-gray-50 p-4 rounded-md",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Name"}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900",children:[t.patient_api_input.first_name," ",t.patient_api_input.last_name]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Date of Birth"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.patient_api_input.dob})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Gender"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 capitalize",children:t.patient_api_input.gender})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Member ID"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.patient_api_input.member_id})]}),t.patient_api_input.id&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"eCW ID"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.patient_api_input.id})]})]})})]})]})]})}),e.jsx("div",{className:"bg-white shadow sm:rounded-lg mt-6",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:p?"Verify or Update Patient Details":"Enter Patient Details Manually"}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"first-name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{type:"text",id:"first-name",value:t.patient_api_input.first_name||"",onChange:s=>b({first_name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"last-name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{type:"text",id:"last-name",value:t.patient_api_input.last_name||"",onChange:s=>b({last_name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"dob",className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),e.jsx("input",{type:"date",id:"dob",value:t.patient_api_input.dob||"",onChange:s=>b({dob:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700",children:"Gender"}),e.jsxs("select",{id:"gender",value:t.patient_api_input.gender||"unknown",onChange:s=>b({gender:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"unknown",children:"Unknown"})]})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"member_id",className:"block text-sm font-medium text-gray-700",children:"Member ID (Insurance)"}),e.jsx("input",{type:"text",id:"member_id",value:t.patient_api_input.member_id||"",onChange:s=>b({member_id:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),t.patient_api_input.id&&e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"ecw_id",className:"block text-sm font-medium text-gray-700",children:"eCW ID"}),e.jsx("input",{type:"text",id:"ecw_id",value:t.patient_api_input.id,readOnly:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-gray-100"})]})]})]})}),e.jsx("div",{className:"bg-white shadow sm:rounded-lg mt-6",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Service & Payer Information"}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"facility_id",className:"block text-sm font-medium text-gray-700",children:"Facility"}),e.jsxs("select",{id:"facility_id",value:t.facility_id||"",onChange:s=>N("facility_id",s.target.value?parseInt(s.target.value):null),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Select Facility"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"expected_service_date",className:"block text-sm font-medium text-gray-700",children:"Expected Service Date"}),e.jsx("input",{type:"date",id:"expected_service_date",value:t.expected_service_date||"",onChange:s=>{const d=new Date(s.target.value),r=new Date;if(r.setHours(0,0,0,0),d<r){m("Expected service date must be a future date");return}m(null),N("expected_service_date",s.target.value)},min:new Date().toISOString().split("T")[0],className:`mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm ${j?"border-red-300":"border-gray-300"}`}),j&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"payer_name",className:"block text-sm font-medium text-gray-700",children:"Payer Name"}),e.jsx("input",{type:"text",id:"payer_name",value:t.payer_name||"",onChange:s=>N("payer_name",s.target.value),placeholder:"e.g., Medicare, Aetna",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"payer_id",className:"block text-sm font-medium text-gray-700",children:"Payer ID"}),e.jsx("input",{type:"text",id:"payer_id",value:t.payer_id||"",onChange:s=>N("payer_id",s.target.value),placeholder:"Payer-specific ID",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"wound_type",className:"block text-sm font-medium text-gray-700",children:"Wound Type"}),e.jsxs("select",{id:"wound_type",value:t.wound_type||"",onChange:s=>N("wound_type",s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Select Wound Type"}),Object.entries(i).map(([s,d])=>e.jsx("option",{value:s,children:d},s))]})]})]})]})}),f.length>0&&e.jsx("div",{className:"bg-white shadow sm:rounded-lg mt-6",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Patient Conditions (from eCW)"}),e.jsx("ul",{className:"mt-4 divide-y divide-gray-200",children:f.map(s=>{var d,r,k,x,A,F,S,E,I;return e.jsxs("li",{className:"py-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[((k=(r=(d=s.code)==null?void 0:d.coding)==null?void 0:r[0])==null?void 0:k.display)||"N/A"," (Code: ",((F=(A=(x=s.code)==null?void 0:x.coding)==null?void 0:A[0])==null?void 0:F.code)||"N/A",")"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Status: ",((I=(E=(S=s.clinicalStatus)==null?void 0:S.coding)==null?void 0:E[0])==null?void 0:I.display)||"N/A"]})]},s.id)})})]})})]})};export{H as default};
