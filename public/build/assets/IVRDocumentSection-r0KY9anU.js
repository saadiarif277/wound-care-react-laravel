import{r as c,c as z,j as e,R as ve}from"./app-CkbwHOkf.js";import{B as L}from"./Button-BFsoRR4y.js";import _e from"./StatusUpdateModal-CDBCQPSg.js";import{X as q}from"./x-CCCTsVjU.js";import{L as $}from"./loader-circle-CzGXBM_P.js";import{C as Y}from"./circle-alert-D5RtSiPV.js";import{E}from"./eye-2c1yoxJs.js";import{D as B}from"./download-Dw1sq69C.js";import{F as w}from"./file-text-3MfHY30h.js";import{B as ue}from"./Button-2TyLRw72.js";import{A as xe,a as fe,D as ke}from"./DocusealEmbed-DHc16Xlt.js";import{a as Q}from"./api-CXAezOed.js";import{t as W}from"./index-DNM8Gtkt.js";import{C as Z}from"./circle-check-big-BZwOB0cM.js";import{i as Se}from"./index.esm-DpsOu67m.js";import{C as Ce,b as Oe,c as Re,a as Fe}from"./card-mI4OQcp1.js";import{C as Ee}from"./chevron-down-BQSbFUOw.js";import{C as Ie}from"./chevron-right-BB6IVksD.js";import{U as oe}from"./upload-D34_G3qK.js";import{T as de}from"./trash-2-N2vmfG2C.js";import{S as me}from"./send-Cwgt1rCK.js";import{C as K}from"./clock-BCNbb55_.js";const Le=({isOpen:t,onClose:l,documentType:d,orderId:m,title:j})=>{const[u,y]=c.useState(null),[h,v]=c.useState(!1),[g,a]=c.useState(null);c.useEffect(()=>{t&&m&&f()},[t,m,d]);const f=async()=>{var n;v(!0),a(null);try{const i=d==="ivr"?`/admin/orders/${m}/ivr-document`:`/admin/orders/${m}/order-form-document`,C=await z.get(i,{headers:{"X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""}});if(C.status!==200)throw new Error(`Failed to fetch ${d} document`);const R=C.data;y(R)}catch(i){a(i instanceof Error?i.message:"Failed to load document")}finally{v(!1)}},S=()=>{if(u!=null&&u.url){const n=document.createElement("a");n.href=u.url,n.download=u.filename||`${d}-${m}.pdf`,n.click()}},O=()=>{u!=null&&u.url&&window.open(u.url,"_blank")},I=n=>{switch(n){case"ivr":return"text-blue-600 bg-blue-100";case"order-form":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},U=n=>{switch(n){case"ivr":return e.jsx(w,{className:"h-5 w-5"});case"order-form":return e.jsx(w,{className:"h-5 w-5"});default:return e.jsx(w,{className:"h-5 w-5"})}};return t?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:l}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-xl transform transition-transform duration-300 ease-in-out",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${I(d)}`,children:U(d)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Order #",m]})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(q,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto",children:[h&&e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading document..."})]})}),g&&e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-8 w-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600 font-medium",children:"Error"}),e.jsx("p",{className:"text-gray-600 text-sm",children:g})]})}),u&&!h&&!g&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Filename:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:u.filename||`${d}-${m}.pdf`})]}),u.size&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Size:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:u.size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:u.contentType})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(L,{onClick:O,className:"w-full",variant:"ghost",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"View Document"]}),e.jsxs(L,{onClick:S,className:"w-full",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Download Document"]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Document Preview"}),e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:'Click "View Document" to see the full document in a new tab'})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx(L,{onClick:l,variant:"ghost",className:"w-full",children:"Close"})})]})})]}):null},Ue=({isOpen:t,onClose:l,orderId:d,orderData:m,onOrderFormComplete:j})=>{const[u,y]=c.useState(!1),[h,v]=c.useState(null),[g,a]=c.useState(!1),[f,S]=c.useState(null);c.useEffect(()=>{t&&m.manufacturer_id&&O()},[t,m.manufacturer_id]);const O=async()=>{var n,i;try{y(!0),v(null);const R=(await Q.get(`/api/v1/manufacturers/${m.manufacturer_id}`)).data.data;if(!R.order_form_template_id){v("No order form template configured for this manufacturer");return}S(R)}catch(C){console.error("Error loading manufacturer config:",C),v(((i=(n=C.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to load manufacturer configuration")}finally{y(!1)}},I=n=>{a(!0),W.success("Order form completed successfully!"),j==null||j(n),setTimeout(()=>{l()},2e3)},U=n=>{v(n),W.error(`Order form error: ${n}`)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(w,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Order Form"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[m.manufacturer_name," • Order #",m.order_number]})]})]}),e.jsx("button",{title:"Close Order Form",onClick:l,className:"p-2 rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:u?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading order form..."})]})}):h?e.jsxs("div",{className:"p-6",children:[e.jsxs(xe,{variant:"destructive",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx(fe,{children:h})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ue,{onClick:l,variant:"ghost",children:"Close"})})]}):g?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(Z,{className:"w-16 h-16 text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Order Form Completed"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your order form has been successfully submitted."})]})}):f?e.jsx("div",{className:"h-full",children:e.jsx(ke,{manufacturerId:String(f.id),templateId:f.order_form_template_id,productCode:"",documentType:"OrderForm",formData:{...m,patient_email:m.patient_email||m.integration_email,integration_email:m.integration_email},episodeId:m.episode_id,onComplete:I,onError:U,className:"h-full",debug:!1})}):e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Y,{className:"w-8 h-8 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No order form template available"})]})})})]})}):null},Te=({manufacturerId:t,productCode:l="",formData:d={},episodeId:m,onComplete:j,onError:u,className:y="",debug:h=!1})=>{const v={status:"loading",submissionSlug:null,error:null,progress:"Initializing Order Form...",templateInfo:void 0},g=(n,i)=>{switch(i.type){case"SET_LOADING":return{...n,status:"loading",progress:i.payload,error:null};case"SET_READY":return{...n,status:"ready",submissionSlug:i.payload.slug,templateInfo:i.payload.templateInfo,progress:"Order form ready!"};case"SET_ERROR":return{...n,status:"error",error:i.payload};case"SET_COMPLETED":return{...n,status:"completed"};case"SET_NO_TEMPLATE":return{...n,status:"no-template"};default:return n}},[a,f]=c.useReducer(g,v),S=c.useRef(!0),O=async()=>{var n,i,C,R,A,M,G,T;try{f({type:"SET_LOADING",payload:"Finding Order Form template..."});const b=await Q.get(`/api/v1/docuseal/templates/order-form/${t}`);h&&console.log("🔍 Template API Response:",b);const p=((n=b.data)==null?void 0:n.template)||b.template;if(!p){console.error("❌ No OrderForm template found:",b),b.debug_info&&console.log("🔍 Debug info:",b.debug_info),f({type:"SET_NO_TEMPLATE"});return}f({type:"SET_LOADING",payload:"Creating Order Form submission..."});const P={template_id:p.docuseal_template_id,manufacturer_id:t,form_data:{},episode_id:m||null};h&&(console.log("🚀 Creating Order Form submission:",P),console.log("🔍 Template details:",{template_id:p.docuseal_template_id,template_name:p.template_name,manufacturer_id:t}));const _=await Q.post("/api/v1/docuseal/orderform/create-submission",P);if(h&&console.log("📡 Submission API Response:",_),!S.current)return;if((i=_.data)!=null&&i.submitter_slug)f({type:"SET_READY",payload:{slug:_.data.submitter_slug,templateInfo:{templateId:p.docuseal_template_id,templateName:p.template_name}}}),h&&(console.log("✅ Order Form submission created:",_.data),console.log("Form URL:",`https://docuseal.com/s/${_.data.submitter_slug}`));else if((C=_.data)!=null&&C.slug)f({type:"SET_READY",payload:{slug:_.data.slug,templateInfo:{templateId:p.docuseal_template_id,templateName:p.template_name}}});else throw new Error(((R=_.data)==null?void 0:R.error)||_.error||_.message||"Failed to create Order Form submission")}catch(b){if(console.error("❌ Order Form submission error:",b),!S.current)return;const p=((M=(A=b.response)==null?void 0:A.data)==null?void 0:M.message)||((T=(G=b.response)==null?void 0:G.data)==null?void 0:T.error)||b.message||"Failed to load Order Form";f({type:"SET_ERROR",payload:p}),u==null||u(p)}},I=c.useCallback(n=>{if(n.origin==="https://docuseal.com")try{const i=typeof n.data=="string"?JSON.parse(n.data):n.data;i.type==="docuseal.completed"&&(h&&console.log("✅ Order Form completed:",i),f({type:"SET_COMPLETED"}),j==null||j(i.payload||i))}catch(i){console.error("Error handling Docuseal message:",i)}},[h,j]);c.useEffect(()=>(S.current=!0,window.addEventListener("message",I),O(),()=>{S.current=!1,window.removeEventListener("message",I)}),[]);const U=()=>{f({type:"SET_LOADING",payload:"Retrying..."}),O()};return a.status==="loading"?e.jsxs("div",{className:`flex flex-col items-center justify-center p-8 min-h-[400px] bg-gray-50 dark:bg-gray-900 rounded-lg ${y}`,children:[e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Preparing Your Order Form"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:a.progress}),m&&e.jsx("div",{className:"mt-4 px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm rounded-full",children:"FHIR Enhanced"})]}):a.status==="no-template"?e.jsxs("div",{className:`flex flex-col items-center justify-center p-8 min-h-[400px] bg-yellow-50 dark:bg-yellow-900 rounded-lg ${y}`,children:[e.jsx(w,{className:"w-12 h-12 text-yellow-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-yellow-900 dark:text-yellow-200 mb-2",children:"No Order Form Template Available"}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 text-center mb-4",children:["No Order Form template has been configured for manufacturer ID: ",t]}),e.jsx("p",{className:"text-yellow-600 dark:text-yellow-400 text-sm text-center mb-4",children:"Please contact your administrator to set up the required Order Form template."}),e.jsxs("div",{className:"text-xs text-yellow-500 text-center",children:[e.jsx("p",{children:"Debug: Check the browser console for more details"}),e.jsx("p",{children:"You can also visit /test-orderform-templates to see available templates"})]})]}):a.status==="error"?e.jsxs("div",{className:`flex flex-col items-center justify-center p-8 min-h-[400px] bg-red-50 dark:bg-red-900 rounded-lg ${y}`,children:[e.jsx(Y,{className:"w-12 h-12 text-red-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200 mb-2",children:"Failed to Load Order Form"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-center mb-4",children:a.error}),e.jsx(ue,{onClick:U,variant:"ghost",size:"sm",children:"Try Again"})]}):a.status==="completed"?e.jsxs("div",{className:`flex flex-col items-center justify-center p-8 min-h-[400px] bg-green-50 dark:bg-green-900 rounded-lg ${y}`,children:[e.jsx(Z,{className:"w-16 h-16 text-green-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-green-900 dark:text-green-200 mb-2",children:"Order Form Completed"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 text-center",children:"Your order form has been successfully submitted."})]}):e.jsxs(Ce,{className:y,children:[e.jsx(Oe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-blue-600"}),"Order Form",a.templateInfo&&e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",a.templateInfo.templateName,")"]})]})}),e.jsx(Fe,{children:a.submissionSlug?e.jsxs("div",{className:"space-y-4",children:[h&&e.jsx(xe,{children:e.jsxs(fe,{children:["Debug: Submission Slug = ",a.submissionSlug]})}),e.jsx(Se,{src:`https://docuseal.com/s/${a.submissionSlug}`,email:d.integration_email||d.patient_email,onComplete:n=>{console.log("Order Form completed:",n),f({type:"SET_COMPLETED"}),j==null||j(n),W.success("Order Form completed successfully!")},customCss:`
                .form-container {
                  background-color: #ffffff;
                  border-radius: 0.5rem;
                }
                .submit-form-button {
                  background-color: rgb(59 130 246);
                  border-radius: 0.375rem;
                  font-weight: 500;
                }
                .submit-form-button:hover {
                  background-color: rgb(37 99 235);
                }
                .field-area-active {
                  border-color: rgb(59 130 246);
                }
              `})]}):e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Preparing Order Form..."})]})})]})},$e=({ivrData:t,orderFormData:l,orderId:d,onUpdateIVRStatus:m,onUploadIVRResults:j,onUpdateOrderFormStatus:u,onManufacturerSubmission:y,isOpen:h=!0,onToggle:v,userRole:g="Admin",orderData:a={}})=>{var ce,ie;const[f,S]=c.useState(!1),[O,I]=c.useState("ivr"),[U,n]=c.useState(""),[i,C]=c.useState(""),[R,A]=c.useState(!1),[M,G]=c.useState("ivr"),[T,b]=c.useState(!1),[p,P]=c.useState(!1),[_,D]=c.useState(!1),[pe,Ae]=c.useState([]),[Me,Pe]=c.useState(!1),[Ve,ee]=c.useState(!1),[ze,H]=c.useState(0),[he,X]=c.useState(!1),[ge,J]=c.useState(!1),[se,je]=c.useState(null),te=s=>{if(!s||typeof s!="string")return"text-gray-600 bg-gray-100";switch(s.toLowerCase()){case"completed":case"approved":case"verified":case"confirmed by manufacturer":return"text-green-600 bg-green-100";case"pending":case"draft":case"n/a":return"text-yellow-600 bg-yellow-100";case"sent":case"submitted to manufacturer":return"text-blue-600 bg-blue-100";case"rejected":case"canceled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},ae=s=>{if(!s||typeof s!="string")return e.jsx(K,{className:"h-4 w-4"});switch(s.toLowerCase()){case"completed":case"approved":case"verified":case"confirmed by manufacturer":return e.jsx(Z,{className:"h-4 w-4"});case"pending":case"draft":case"n/a":return e.jsx(K,{className:"h-4 w-4"});case"sent":case"submitted to manufacturer":return e.jsx(me,{className:"h-4 w-4"});case"rejected":case"canceled":return e.jsx(Y,{className:"h-4 w-4"});default:return e.jsx(K,{className:"h-4 w-4"})}},re=(s,r,x)=>{I(s),n(r),C(x),S(!0)},be=async s=>{P(!0);try{const r=O==="ivr"?"ivr":"order",N={Sent:"sent",Verified:"verified",Rejected:"rejected",Pending:"pending","N/A":"n/a",submitted_to_manufacturer:"submitted_to_manufacturer",confirmed_by_manufacturer:"confirmed_by_manufacturer",Canceled:"canceled"}[s.status]||s.status.toLowerCase().replace(/ /g,"_"),o=new FormData;o.append("status",N),o.append("status_type",r),o.append("notes",s.comments||""),o.append("rejection_reason",s.rejectionReason||""),o.append("cancellation_reason",s.cancellationReason||""),o.append("send_notification",s.sendNotification?"1":"0"),o.append("carrier",s.carrier||""),o.append("tracking_number",s.trackingNumber||""),s.statusDocuments&&s.statusDocuments.length>0&&s.statusDocuments.forEach((k,V)=>{o.append(`status_documents[${V}]`,k)}),s.notificationDocuments&&s.notificationDocuments.length>0&&s.notificationDocuments.forEach((k,V)=>{o.append(`notification_documents[${V}]`,k)});const F=await z.post(`/admin/orders/${d}/change-status`,o,{headers:{"Content-Type":"multipart/form-data"}});if(F.status===200){const k={...s,status:s.status,backendStatus:N};O==="ivr"?m(k):u(k)}else{const k=F.data;console.error("Status update failed:",k.error||`Failed to update ${r} status`)}}catch(r){console.error("Status update error:",r)}finally{P(!1)}},le=async(s,r)=>{var N;const x=(N=s.target.files)==null?void 0:N[0];if(x){ee(!0),H(0);try{const o=new FormData;o.append("file",x),o.append("file_type",r==="ivr"?"ivr":"order_form");const F=await z.post(`/admin/orders/${d}/upload-file`,o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:k=>{if(k.total){const V=Math.round(k.loaded*100/k.total);H(V)}}});F.data.success?window.location.reload():(console.error("Upload failed:",F.data.message),alert("Upload failed: "+F.data.message))}catch(o){console.error("Upload error:",o),alert("Upload failed. Please try again.")}finally{ee(!1),H(0),s.target.value=""}}},ne=async s=>{if(confirm("Are you sure you want to remove this file?"))try{const r=await z.delete(`/admin/orders/${d}/remove-file`,{data:{file_type:s==="ivr"?"ivr":"order_form"}});r.data.success?window.location.reload():(console.error("Remove failed:",r.data.message),alert("Remove failed: "+r.data.message))}catch(r){console.error("Remove error:",r),alert("Remove failed. Please try again.")}},Ne=s=>{G(s),A(!0)},ye=async()=>{var s;if((s=t.alteredIvrFile)!=null&&s.url){window.open(t.alteredIvrFile.url,"_blank");return}if(t.docusealSubmissionId){b(!0);try{const x=await(await fetch(`/admin/orders/${d}/docuseal-document-url`)).json();if(x.success&&x.document_url)console.log("🔍 Opening Docuseal document URL:",x.document_url),window.open(x.document_url,"_blank");else{console.error("❌ Failed to get document URL:",x.message);const o=await(await fetch(`/admin/orders/${d}/docuseal-document`)).json();if(o.success&&o.document_url)console.log("🔍 Opening Docuseal document URL:",o.document_url),window.open(o.document_url,"_blank");else{const F=`https://docuseal.com/e/${t.docusealSubmissionId}`;console.log("🔍 Using fallback URL:",F),window.open(F,"_blank")}}}catch(r){console.error("❌ Error fetching document URL:",r);try{const N=await(await fetch(`/admin/orders/${d}/docuseal-document`)).json();if(N.success&&N.document_url)console.log("🔍 Opening Docuseal document URL:",N.document_url),window.open(N.document_url,"_blank");else{const o=`https://docuseal.com/e/${t.docusealSubmissionId}`;console.log("🔍 Using fallback URL:",o),window.open(o,"_blank")}}catch(x){console.error("❌ Fallback method also failed:",x);const N=`https://docuseal.com/e/${t.docusealSubmissionId}`;console.log("🔍 Using final fallback URL:",N),window.open(N,"_blank")}}finally{b(!1)}}else t.ivrDocumentUrl?window.open(t.ivrDocumentUrl,"_blank"):Ne("ivr")},we=async()=>{if(console.log("🔍 getManufacturerIdFromProduct called with:",{product_id:a.product_id,orderData:a}),!a.product_id)return console.error("❌ No product_id available in orderData"),null;try{console.log("📡 Calling API for product:",a.product_id);const s=await z.get(`/api/v1/products/${a.product_id}`);if(console.log("📡 API response:",s.data),s.data.success&&s.data.product){const r=s.data.product.manufacturer_id;return console.log("✅ Found manufacturer_id:",r),je((r==null?void 0:r.toString())||null),r==null?void 0:r.toString()}else console.error("❌ API response not successful:",s.data)}catch(s){console.error("❌ Error fetching product manufacturer:",s)}return null};return ve.useEffect(()=>{var s,r;console.log("🔍 useEffect triggered:",{product_id:a.product_id,ivr_status:t.status,ivr_verified:((s=t.status)==null?void 0:s.toLowerCase())==="verified"}),a.product_id&&((r=t.status)==null?void 0:r.toLowerCase())==="verified"?(console.log("✅ Conditions met, calling getManufacturerIdFromProduct"),we()):console.log("❌ Conditions not met for manufacturer lookup")},[a.product_id,t.status]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 cursor-pointer hover:bg-gray-50",onClick:v,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"h-5 w-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"IVR & Document Management"})]}),v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Manage IVR and Order Forms"}),h?e.jsx(Ee,{className:"h-5 w-5 text-gray-400"}):e.jsx(Ie,{className:"h-5 w-5 text-gray-400"})]})]}),h&&e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900",children:"IVR Management"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${te(t.status)}`,children:[ae(t.status),t.status]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{onClick:ye,className:"flex-1",variant:"ghost",size:"sm",disabled:T,children:[T?e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),T?"Loading...":"View IVR Form"]})}),g==="Admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"IVR Status"}),e.jsxs("select",{value:t.status,onChange:s=>re("ivr",t.status,s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[e.jsx("option",{value:"n/a",children:"N/A"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"IVR Documents"}),g==="Admin"&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:s=>le(s,"ivr")}),e.jsxs("div",{className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 text-sm",children:[e.jsx(oe,{className:"h-4 w-4"}),"Add File"]})]})]}),t.alteredIvrFile?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-green-800",children:t.alteredIvrFile.name}),e.jsxs("div",{className:"text-xs text-green-600",children:["Uploaded by ",t.alteredIvrFile.uploadedBy," on ",new Date(t.alteredIvrFile.uploadedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>window.open(t.alteredIvrFile.url,"_blank"),className:"text-blue-600 hover:text-blue-700",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{const s=window.document.createElement("a");s.href=t.alteredIvrFile.url,s.download=t.alteredIvrFile.name,s.click()},className:"text-green-600 hover:text-green-700",children:e.jsx(B,{className:"h-4 w-4"})}),g==="Admin"&&e.jsx("button",{onClick:()=>ne("ivr"),className:"text-red-600 hover:text-red-700",children:e.jsx(de,{className:"h-4 w-4"})})]})]})}):t.files&&t.files.length>0?e.jsx("div",{className:"space-y-2",children:t.files.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"text-blue-600 hover:text-blue-700",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{const r=window.document.createElement("a");r.href=s.url,r.download=s.name,r.click()},className:"text-green-600 hover:text-green-700",children:e.jsx(B,{className:"h-4 w-4"})})]})]},s.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No IVR documents uploaded"})]}),t.notes&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-md",children:e.jsx("p",{className:"text-sm text-blue-800",children:t.notes})}),t.rejectionReason&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:t.rejectionReason})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900",children:"Order Form Management"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${te(l.status)}`,children:[ae(l.status),l.status]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[((ce=t.status)==null?void 0:ce.toLowerCase())==="verified"?e.jsxs(L,{onClick:()=>J(!0),className:"flex-1",variant:"ghost",size:"sm",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"View Order Form"]}):e.jsxs(L,{className:"flex-1",variant:"ghost",size:"sm",disabled:!0,title:"Order Form available after IVR verification",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"View Order Form"]}),((ie=t.status)==null?void 0:ie.toLowerCase())==="verified"&&e.jsxs(L,{onClick:()=>X(!0),className:"flex-1",variant:"primary",size:"sm",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Complete Order Form"]})]}),g==="Admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Order Form Status"}),e.jsxs("select",{value:l.status,onChange:s=>re("order",l.status,s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"submitted_to_manufacturer",children:"Submitted to Manufacturer"}),e.jsx("option",{value:"confirmed_by_manufacturer",children:"Confirmed by Manufacturer"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"canceled",children:"Canceled"})]})]}),g==="Admin"&&l.status==="pending"&&y&&e.jsx("div",{className:"pt-2",children:e.jsxs(L,{onClick:y,className:"w-full",variant:"primary",size:"sm",disabled:p,children:[p?e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(me,{className:"h-4 w-4 mr-2"}),p?"Updating...":"Submit to Manufacturer"]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Order Form Documents"}),g==="Admin"&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:s=>le(s,"order")}),e.jsxs("div",{className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 text-sm",children:[e.jsx(oe,{className:"h-4 w-4"}),"Add File"]})]})]}),l.alteredOrderFormFile?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-green-800",children:l.alteredOrderFormFile.name}),e.jsxs("div",{className:"text-xs text-green-600",children:["Uploaded by ",l.alteredOrderFormFile.uploadedBy," on ",new Date(l.alteredOrderFormFile.uploadedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>window.open(l.alteredOrderFormFile.url,"_blank"),className:"text-blue-600 hover:text-blue-700",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{const s=window.document.createElement("a");s.href=l.alteredOrderFormFile.url,s.download=l.alteredOrderFormFile.name,s.click()},className:"text-green-600 hover:text-green-700",children:e.jsx(B,{className:"h-4 w-4"})}),g==="Admin"&&e.jsx("button",{onClick:()=>ne("order"),className:"text-red-600 hover:text-red-700",children:e.jsx(de,{className:"h-4 w-4"})})]})]})}):l.files&&l.files.length>0?e.jsx("div",{className:"space-y-2",children:l.files.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"text-blue-600 hover:text-blue-700",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{const r=window.document.createElement("a");r.href=s.url,r.download=s.name,r.click()},className:"text-green-600 hover:text-green-700",children:e.jsx(B,{className:"h-4 w-4"})})]})]},s.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No order form documents uploaded"})]}),(l.status==="submitted_to_manufacturer"||l.status==="confirmed_by_manufacturer")&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-md",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-800",children:"Shipping Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Carrier"}),e.jsx("input",{type:"text",value:l.carrier||"",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., FedEx, UPS",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tracking #"}),e.jsx("input",{type:"text",value:l.trackingNumber||"",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Tracking number",readOnly:!0})]})]}),l.shippingInfo&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("p",{children:["Submitted: ",new Date(l.shippingInfo.submitted_at).toLocaleDateString()]}),e.jsxs("p",{children:["By: ",l.shippingInfo.submitted_by]})]})]}),l.notes&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-md",children:e.jsx("p",{className:"text-sm text-blue-800",children:l.notes})}),l.rejectionReason&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:l.rejectionReason})]}),l.cancellationReason&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Cancellation Reason:"}),e.jsx("p",{className:"text-sm text-red-700",children:l.cancellationReason})]})]})]})})]}),e.jsx(_e,{isOpen:f,onClose:()=>S(!1),onConfirm:be,type:O,currentStatus:U,newStatus:i,orderId:d.toString()}),e.jsx(Le,{isOpen:R,onClose:()=>A(!1),documentType:M,orderId:d.toString(),title:M==="ivr"?"IVR Document":"Order Form Document"}),_&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"max-w-2xl w-full mx-4 p-6 rounded-lg shadow-xl bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Docuseal Signer URLs"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"space-y-3",children:pe.map((s,r)=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:s.name?s.name.charAt(0).toUpperCase():"S"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name||`Signer ${r+1}`}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="completed"?"text-green-600 bg-green-100":s.status==="pending"?"text-yellow-600 bg-yellow-100":"text-gray-600 bg-gray-100"}`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>window.open(s.url,"_blank"),className:"flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(E,{className:"h-4 w-4 mr-2 inline"}),"Open Document"]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.url)},className:"px-3 py-2 border border-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-50 transition-colors",children:"Copy URL"})]}),s.completed_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Completed: ",new Date(s.completed_at).toLocaleString()]})]},s.id||r))}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Close"})})]})}),ge&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Order Form"}),e.jsx("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(q,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 p-6 overflow-auto",children:(()=>{var r;const s=se||((r=a.manufacturer_id)==null?void 0:r.toString())||"1";return console.log("🔍 OrderFormEmbed manufacturerId debug:",{productManufacturerId:se,orderData_manufacturer_id:a.manufacturer_id,finalManufacturerId:s,orderData:a}),e.jsx(Te,{manufacturerId:s,productCode:"",formData:{order_number:a.order_number||`Order #${d}`,manufacturer_name:a.manufacturer_name||"Manufacturer",patient_name:a.patient_name||"Patient Name",patient_email:a.patient_email||"patient@example.com",integration_email:a.integration_email||"integration@example.com",episode_id:a.episode_id},episodeId:a.episode_id,onComplete:x=>{console.log("Order form completed:",x),J(!1)},onError:x=>{console.error("Order form error:",x)},className:"h-full",debug:!0})})()})]})}),e.jsx(Ue,{isOpen:he,onClose:()=>X(!1),orderId:d.toString(),orderData:{id:d.toString(),order_number:a.order_number||`Order #${d}`,manufacturer_name:a.manufacturer_name||"Manufacturer",manufacturer_id:a.manufacturer_id||1,patient_name:a.patient_name||"Patient Name",patient_email:a.patient_email||"patient@example.com",integration_email:a.integration_email||"integration@example.com",episode_id:a.episode_id||1,ivr_status:t.status,order_form_status:l.status,docuseal_submission_id:t.docusealSubmissionId,order_form_submission_id:l.fileUrl},onOrderFormComplete:s=>{console.log("Order form completed:",s),X(!1)}})]})},ds=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{$e as I,Ue as O,ds as a};
