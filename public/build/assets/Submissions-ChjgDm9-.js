import{r,j as e,S as c}from"./app-taSqzBVs.js";import{M as i}from"./MainLayout-Dw1zk4VW.js";import{k as n,f,c as w,u as v,w as A,h as O}from"./index-BQkVVL-M.js";import{a as b}from"./api-D-Fi0ivM.js";import"./x-tQL0mm7-.js";import"./createLucideIcon-CJpMkWaB.js";import"./triangle-alert-BOyfSih_.js";import"./check-B1Sfkp9P.js";function J({auth:R}){const[x,S]=r.useState([]),[_,m]=r.useState(!0),[o,h]=r.useState(null),[l,k]=r.useState({totalSubmissions:0,pendingSignatures:0,completedToday:0,overdue:0}),d=async()=>{m(!0),h(null);try{const a=(await b.docuseal.getSubmissions()).data.map(s=>{var u,p,j,N,y;return{id:s.id,order_number:((u=s.order)==null?void 0:u.order_number)||"Unknown Order",document_type:s.document_type,status:s.status,created_at:s.created_at,completed_at:s.completed_at,signer_name:((j=(p=s.order)==null?void 0:p.provider)==null?void 0:j.name)||"Unknown Signer",signer_email:((y=(N=s.order)==null?void 0:N.provider)==null?void 0:y.email)||"unknown@email.com",signing_url:s.signing_url,download_url:s.download_url}});S(a);const F=a.length,M=a.filter(s=>s.status==="pending").length,T=new Date().toDateString(),$=a.filter(s=>s.status==="completed"&&s.completed_at&&new Date(s.completed_at).toDateString()===T).length,L=a.filter(s=>s.status==="overdue").length;k({totalSubmissions:F,pendingSignatures:M,completedToday:$,overdue:L})}catch(t){h(t instanceof Error?t.message:"Failed to fetch submissions"),console.error("Error fetching DocuSeal submissions:",t)}finally{m(!1)}};r.useEffect(()=>{d()},[]);const D=t=>{switch(t){case"completed":return e.jsx(w,{className:"w-5 h-5 text-green-500"});case"pending":return e.jsx(f,{className:"w-5 h-5 text-yellow-500"});case"overdue":return e.jsx(v,{className:"w-5 h-5 text-red-500"});default:return e.jsx(n,{className:"w-5 h-5 text-gray-500"})}},C=t=>{const a="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(t){case"completed":return`${a} bg-green-100 text-green-800`;case"pending":return`${a} bg-yellow-100 text-yellow-800`;case"overdue":return`${a} bg-red-100 text-red-800`;case"expired":return`${a} bg-gray-100 text-gray-800`;case"cancelled":return`${a} bg-red-100 text-red-800`;default:return`${a} bg-gray-100 text-gray-800`}},E=async t=>{try{await b.docuseal.downloadDocument(t)}catch(a){console.error("Error downloading document:",a),alert("Failed to download document. Please try again.")}},g=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return _?e.jsxs(i,{children:[e.jsx(c,{title:"Document Management"}),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading document submissions..."})]})})]}):o?e.jsxs(i,{children:[e.jsx(c,{title:"Document Management"}),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-lg mb-4",children:"Error loading submissions"}),e.jsx("div",{className:"text-gray-600 mb-4",children:o}),e.jsx("button",{onClick:d,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Try Again"})]})})]}):e.jsxs(i,{children:[e.jsx(c,{title:"Document Management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Document Management"}),e.jsx("p",{className:"text-gray-500",children:"Manage and track document signatures for orders"})]}),e.jsxs("button",{onClick:d,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(n,{className:"h-8 w-8 text-blue-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Submissions"}),e.jsx("dd",{className:"text-2xl font-semibold text-gray-900",children:l.totalSubmissions})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(f,{className:"h-8 w-8 text-yellow-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Pending Signatures"}),e.jsx("dd",{className:"text-2xl font-semibold text-gray-900",children:l.pendingSignatures})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(w,{className:"h-8 w-8 text-green-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Completed Today"}),e.jsx("dd",{className:"text-2xl font-semibold text-gray-900",children:l.completedToday})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(v,{className:"h-8 w-8 text-red-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Overdue"}),e.jsx("dd",{className:"text-2xl font-semibold text-gray-900",children:l.overdue})]})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Document Submissions"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Latest document signing requests and their status"})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order / Document"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Signer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[D(t.status),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.order_number}),e.jsx("div",{className:"text-sm text-gray-500",children:t.document_type})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.signer_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.signer_email})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:C(t.status),children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:g(t.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.completed_at?g(t.completed_at):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[t.status==="completed"&&t.download_url&&e.jsxs("button",{onClick:()=>E(t.id),className:"text-blue-600 hover:text-blue-900 flex items-center",children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),"Download"]}),t.signing_url&&t.status==="pending"&&e.jsxs("a",{href:t.signing_url,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Sign"]})]})})]},t.id))})]})}),x.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(n,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No document submissions found"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Document submissions will appear here when orders are processed."})]})]})]})]})]})}export{J as default};
