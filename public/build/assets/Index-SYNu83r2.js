import{r as o,j as e,S as K,A as B,c as Q,G as Y}from"./app-CkbwHOkf.js";import{M as Z}from"./MainLayout-DIjIBnGe.js";import{E as D,x as T,X as O,G as ee,K as se,v as U,a as ae,a3 as te,b as ie,S as re,f as le,_ as ce,ar as de,as as ne}from"./index-R2fUhcwH.js";import{c as b}from"./index-JQJDRhvj.js";import{M as V}from"./Modal-C121qWjY.js";import"./glass-theme-CCnqi7lL.js";import"./x-CCCTsVjU.js";import"./createLucideIcon-HYdXrwBu.js";import"./triangle-alert-D2zL4pqG.js";import"./check-DXIgFk-v.js";function ve({userRoles:j,permissions:a,users:h,roleStats:g,permissionStats:u,userDistribution:x,totalUsers:i,totalRoles:r,totalPermissions:c}){const[m,v]=o.useState("overview"),[w,f]=o.useState(null),[_,t]=o.useState(null),[d,l]=o.useState(!1),[R,C]=o.useState(!1),[S,G]=o.useState([]),[z,k]=o.useState(!1),A=s=>s.name==="super-admin"?"critical":s.name==="msc-admin"?"high":["msc-rep","provider"].includes(s.name)?"medium":"low",H=s=>{switch(s){case"critical":return"text-red-600 bg-red-50";case"high":return"text-orange-600 bg-orange-50";case"medium":return"text-yellow-600 bg-yellow-50";default:return"text-green-600 bg-green-50"}},q=async s=>{if(!R){if(["super-admin","msc-admin"].includes(s.name)&&s.is_active){b.error("System roles cannot be disabled");return}C(!0);try{await B.post(`/rbac/role/${s.id}/toggle-status`,{},{preserveScroll:!0,onSuccess:()=>{b.success(`Role ${s.is_active?"disabled":"enabled"} successfully`)},onError:()=>{b.error("Failed to update role status")}})}finally{C(!1)}}},[I,F]=o.useState(!1),W=s=>{f(s),F(!0)},X=s=>{t(s),l(!0)},M=()=>{l(!1),t(null)},J=async()=>{var s;k(!0);try{const n=await Q.get("/rbac/security-audit");G(((s=n.data.audit_logs)==null?void 0:s.data)||[])}catch{b.error("Failed to load audit logs")}finally{k(!1)}};o.useEffect(()=>{m==="audit"&&S.length===0&&J()},[m]);const y=({title:s,value:n,icon:p,color:N})=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${N}`,children:e.jsx(p,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n})]})]})});return e.jsxs(Z,{children:[e.jsx(K,{title:"RBAC Configuration"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx(D,{className:"mr-3 text-blue-600"}),"Role-Based Access Control"]}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage user roles, permissions, and access control across the platform"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(y,{title:"Total Users",value:i,icon:T,color:"bg-blue-500"}),e.jsx(y,{title:"Active Roles",value:r,icon:O,color:"bg-green-500"}),e.jsx(y,{title:"Permissions",value:c,icon:ee,color:"bg-purple-500"}),e.jsx(y,{title:"Security Level",value:"High",icon:D,color:"bg-orange-500"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview",icon:se},{id:"roles",label:"Role Management",icon:T},{id:"permissions",label:"Permissions",icon:O},{id:"audit",label:"Security Audit",icon:U}].map(s=>e.jsxs("button",{onClick:()=>v(s.id),className:`flex items-center py-2 px-1 border-b-2 font-medium text-sm ${m===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(s.icon,{className:"mr-2 h-4 w-4"}),s.label]},s.id))})}),m==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Role Distribution"}),e.jsx("div",{className:"space-y-4",children:x.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 mr-3"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.role})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[s.count," users"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[s.percentage,"%"]})]})]},n))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ae,{className:"mr-2"}),"Recent RBAC Changes"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"h-4 w-4 text-yellow-600 mr-3"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Role permissions updated for MSC Admin"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"2 hours ago"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 text-green-600 mr-3"}),e.jsx("span",{className:"text-sm text-gray-900",children:"New user assigned Office Manager role"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"1 day ago"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 text-red-600 mr-3"}),e.jsx("span",{className:"text-sm text-gray-900",children:"User access revoked for security violation"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"3 days ago"})]})]})]})]}),m==="roles"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Role Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure roles and their permissions"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:g.map(s=>{var n,p,N,L,$,E,P;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${H(A(s))}`,children:A(s).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:s.display_name||s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description||""})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.user_count," users"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Level ",s.hierarchy_level]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>W(s),className:"p-2 text-gray-400 hover:text-gray-600",title:"View role details",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>X(s),className:"p-2 text-gray-400 hover:text-gray-600",title:"Edit role permissions",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>q(s),className:"p-2 text-gray-400 hover:text-gray-600",title:s.is_active?"Disable role":"Enable role",disabled:R,children:s.is_active?e.jsx(de,{className:"h-4 w-4 text-green-500"}):e.jsx(ne,{className:"h-4 w-4 text-gray-400"})})]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${(n=s.dashboard_config)!=null&&n.financial_access?"bg-green-500":"bg-red-500"}`}),"Financial Access"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${((p=s.dashboard_config)==null?void 0:p.pricing_access)==="full"?"bg-green-500":"bg-yellow-500"}`}),"Pricing: ",((N=s.dashboard_config)==null?void 0:N.pricing_access)||"Limited"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${(($=(L=s.dashboard_config)==null?void 0:L.admin_capabilities)==null?void 0:$.length)>0?"bg-green-500":"bg-gray-400"}`}),"Admin Capabilities"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${(P=(E=s.dashboard_config)==null?void 0:E.customer_data_restrictions)!=null&&P.includes("no_phi")?"bg-red-500":"bg-green-500"}`}),"PHI Access"]})]})]},s.id)})})})]}),m==="permissions"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Permission Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View and manage system permissions"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Used by ",s.roles_count," role",s.roles_count!==1?"s":""]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.roles.slice(0,2).map((n,p)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:n},p)),s.roles.length>2&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["+",s.roles.length-2]})]})]})]},s.id))})})]}),m==="audit"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Security Audit Log"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monitor RBAC changes and security events"})]}),e.jsx("div",{className:"p-6",children:z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading audit logs..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No audit logs found"}),e.jsx("p",{className:"text-sm",children:"Security events will appear here when they occur"})]}):e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.risk_level==="high"?"border-red-200 bg-red-50":s.risk_level==="medium"?"border-yellow-200 bg-yellow-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`text-sm font-medium ${s.risk_level==="high"?"text-red-700":s.risk_level==="medium"?"text-yellow-700":"text-gray-700"}`,children:s.event_type}),s.risk_level&&e.jsxs("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${s.risk_level==="high"?"bg-red-100 text-red-700":s.risk_level==="medium"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:[s.risk_level," risk"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.entity_type,": ",s.entity_name]}),s.performed_by&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["By: ",s.performed_by.name," (",s.performed_by.email,")"]}),s.reason&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Reason: ",s.reason]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),s.changes&&Object.keys(s.changes).length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Changes: ",JSON.stringify(s.changes)]})]},s.id))})})]})]})}),e.jsx(xe,{show:d,role:_,permissions:a,onClose:M,onSuccess:()=>{M(),B.reload({only:["userRoles","roleStats"]})}}),e.jsx(me,{show:I,role:w,permissions:a,onClose:()=>{F(!1),f(null)}})]})}function xe({show:j,role:a,permissions:h,onClose:g,onSuccess:u}){const{data:x,setData:i,put:r,processing:c,errors:m,reset:v}=Y({permission_ids:[],reason:""});o.useEffect(()=>{if(a){const t=h.filter(d=>a.permissions.includes(d.slug)).map(d=>d.id);i("permission_ids",t)}},[a,h]);const w=t=>{t.preventDefault(),a&&r(`/rbac/role/${a.id}/permissions`,{preserveScroll:!0,onSuccess:()=>{b.success("Role permissions updated successfully"),v(),u()},onError:()=>{b.error("Failed to update role permissions")}})},f=t=>{i("permission_ids",x.permission_ids.includes(t)?x.permission_ids.filter(d=>d!==t):[...x.permission_ids,t])};if(!a)return null;const _=h.reduce((t,d)=>{const l=d.slug.split("-")[0];return t[l]||(t[l]=[]),t[l].push(d),t},{});return e.jsx(V,{show:j,onClose:g,maxWidth:"2xl",children:e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Edit Role: ",a.display_name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:a.description}),e.jsx("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:Object.entries(_).map(([t,d])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 capitalize",children:[t," Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.map(l=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.permission_ids.includes(l.id),onChange:()=>f(l.id),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:["super-admin","msc-admin"].includes(a.name)&&["manage-rbac","manage-all-organizations"].includes(l.slug)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500",children:l.description})]})]},l.id))})]},t))}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Change (Required)"}),e.jsx("textarea",{value:x.reason,onChange:t=>i("reason",t.target.value),rows:3,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Please provide a reason for these permission changes...",required:!0}),m.reason&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.reason})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[a.user_count," user",a.user_count!==1?"s":""," will be affected"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c||!x.reason,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Saving...":"Save Changes"})]})]})]})})}function me({show:j,role:a,permissions:h,onClose:g}){if(!a)return null;const u=h.filter(i=>a.permissions.includes(i.slug)),x=u.reduce((i,r)=>{const c=r.slug.split("-")[0];return i[c]||(i[c]=[]),i[c].push(r),i},{});return e.jsxs(V,{show:j,onClose:g,maxWidth:"2xl",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.display_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.user_count}),e.jsx("p",{className:"text-sm text-gray-600",children:"Users"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.permissions.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Permissions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:["Level ",a.hierarchy_level]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Hierarchy"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Dashboard Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.dashboard_config.financial_access?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-700",children:"Financial Access"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.dashboard_config.pricing_access==="full"?"bg-green-500":a.dashboard_config.pricing_access==="limited"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Pricing Access: ",a.dashboard_config.pricing_access||"None"]})]}),a.dashboard_config.admin_capabilities&&a.dashboard_config.admin_capabilities.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-1",children:"Admin Capabilities:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.dashboard_config.admin_capabilities.map((i,r)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:i.replace(/_/g," ")},r))})]}),a.dashboard_config.customer_data_restrictions&&a.dashboard_config.customer_data_restrictions.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-1",children:"Data Restrictions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.dashboard_config.customer_data_restrictions.map((i,r)=>e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:i.replace(/_/g," ")},r))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:["Permissions (",u.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-64 overflow-y-auto",children:Object.entries(x).map(([i,r])=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-2 capitalize",children:[i," (",r.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.map(c=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-gray-700",children:c.name}),e.jsx("p",{className:"text-xs text-gray-500",children:c.description})]},c.id))})]},i))})]})]}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Close"})})]})}export{ve as default};
