<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    /**
     * MUE values from hard-coded data in ProductSelectorQuickRequest.tsx
     * These values will be populated into the database
     */
    private array $mueLimits = [
        'Q4100' => 1100,
        'Q4101' => 1100,
        'Q4102' => 1100,
        'Q4103' => 1100,
        'Q4104' => 1100,
        'Q4105' => 1100,
        'Q4106' => 1100,
        'Q4107' => 100,
        'Q4108' => 100,
        'Q4110' => 100,
        'Q4111' => 100,
        'Q4112' => 100,
        'Q4113' => 100,
        'Q4114' => 100,
        'Q4115' => 100,
        'Q4116' => 100,
        'Q4117' => 100,
        'Q4118' => 100,
        'Q4119' => 100,
        'Q4120' => 100,
        'Q4121' => 18,
        'Q4122' => 1100,
        'Q4123' => 100,
        'Q4124' => 100,
        'Q4125' => 100,
        'Q4126' => 1100,
        'Q4127' => 100,
        'Q4128' => 100,
        'Q4129' => 1100,
        'Q4130' => 100,
        'Q4131' => 1100,
        'Q4132' => 100,
        'Q4133' => 100,
        'Q4134' => 100,
        'Q4135' => 100,
        'Q4136' => 100,
        'Q4137' => 100,
        'Q4138' => 100,
        'Q4139' => 1100,
        'Q4140' => 100,
        'Q4141' => 1100,
        'Q4142' => 100,
        'Q4143' => 100,
        'Q4145' => 100,
        'Q4146' => 100,
        'Q4147' => 100,
        'Q4148' => 16,
        'Q4149' => 100,
        'Q4150' => 50,
        'Q4151' => 1100,
        'Q4152' => 1100,
        'Q4153' => 100,
        'Q4154' => 100,
        'Q4155' => 100,
        'Q4156' => 100,
        'Q4157' => 100,
        'Q4158' => 100,
        'Q4159' => 100,
        'Q4160' => 100,
        'Q4161' => 100,
        'Q4162' => 1100,
        'Q4163' => 100,
        'Q4164' => 100,
        'Q4165' => 100,
        'Q4166' => 100,
        'Q4167' => 100,
        'Q4168' => 100,
        'Q4169' => 100,
        'Q4170' => 100,
        'Q4171' => 25,
        'Q4172' => 1100,
        'Q4173' => 100,
        'Q4174' => 450,
        'Q4175' => 100,
        'Q4176' => 64,
        'Q4177' => 100,
        'Q4178' => 100,
        'Q4179' => 100,
        'Q4180' => 100,
        'Q4181' => 100,
        'Q4182' => 100,
        'Q4183' => 48,
        'Q4184' => 1100,
        'Q4185' => 25,
        'Q4186' => 36,
        'Q4187' => 100,
        'Q4188' => 100,
        'Q4189' => 100,
        'Q4190' => 100,
        'Q4191' => 1100,
        'Q4192' => 1100,
        'Q4193' => 100,
        'Q4194' => 100,
        'Q4195' => 100,
        'Q4196' => 100,
        'Q4197' => 100,
        'Q4198' => 100,
        'Q4199' => 100,
        'Q4200' => 100,
        'Q4201' => 3600,
        'Q4202' => 1100,
        'Q4203' => 100,
        'Q4204' => 48,
        'Q4205' => 540,
        'Q4206' => 100,
        'Q4208' => 100,
        'Q4209' => 80,
        'Q4210' => 100,
        'Q4211' => 100,
        'Q4212' => 100,
        'Q4213' => 100,
        'Q4214' => 100,
        'Q4215' => 100,
        'Q4216' => 100,
        'Q4217' => 100,
        'Q4218' => 100,
        'Q4219' => 540,
        'Q4220' => 100,
        'Q4221' => 100,
        'Q4222' => 100,
        'Q4224' => 1,
        'Q4225' => 1,
        'Q4226' => 48,
        'Q4227' => 48,
        'Q4229' => 48,
        'Q4230' => 48,
        'Q4231' => 100,
        'Q4232' => 500,
        'Q4233' => 50,
        'Q4234' => 100,
        'Q4235' => 100,
        'Q4236' => 100,
        'Q4237' => 100,
        'Q4238' => 100,
        'Q4239' => 100,
        'Q4240' => 100,
        'Q4241' => 100,
        'Q4242' => 100,
        'Q4244' => 540,
        'Q4245' => 1000,
        'Q4246' => 400,
        'Q4247' => 48,
        'Q4248' => 48,
        'Q4249' => 100,
        'Q4250' => 100,
        'Q4251' => 100,
        'Q4252' => 100,
        'Q4253' => 100,
        'Q4254' => 100,
        'Q4255' => 810,
        'Q4256' => 810,
        'Q4257' => 1100,
        'Q4258' => 540,
        'Q4259' => 100,
        'Q4260' => 100,
        'Q4261' => 100,
        'Q4262' => 100,
        'Q4263' => 100,
        'Q4264' => 100,
        'Q4265' => 100,
        'Q4266' => 100,
        'Q4267' => 100,
        'Q4268' => 100,
        'Q4269' => 100,
        'Q4270' => 480,
        'Q4271' => 100,
        'Q4272' => 100,
        'Q4273' => 100,
        'Q4274' => 100,
        'Q4275' => 100,
        'Q4276' => 100,
        'Q4277' => 100,
        'Q4278' => 100,
        'Q4279' => 100,
        'Q4280' => 100,
        'Q4281' => 100,
        'Q4282' => 100,
        'Q4283' => 416,
        'Q4284' => 100,
        'Q4285' => 100,
        'Q4286' => 100,
        'Q4287' => 100,
        'Q4288' => 100,
        'Q4289' => 100,
        'Q4290' => 100,
        'Q4291' => 100,
        'Q4292' => 100,
        'Q4293' => 100,
        'Q4294' => 100,
        'Q4295' => 100,
        'Q4296' => 100,
        'Q4297' => 100,
        'Q4298' => 100,
        'Q4299' => 100,
        'Q4300' => 100,
        'Q4301' => 100,
        'Q4302' => 100,
        'Q4303' => 100,
        'Q4304' => 100,
        'Q4305' => 80,
        'Q4306' => 100,
        'Q4307' => 100,
        'Q4308' => 32,
        'Q4309' => 100,
        'Q4310' => 4,
        'Q4311' => 100,
        'Q4313' => 100,
        'Q4314' => 100,
        'Q4315' => 100,
        'Q4316' => 300,
        'Q4317' => 100,
        'Q4318' => 100,
        'Q4319' => 100,
        'Q4320' => 100,
        'Q4321' => 100,
        'Q4345' => 100,
        'Q4346' => 100,
        'Q4347' => 100,
    ];

    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // Update MUE values for all products matching the Q-codes
        foreach ($this->mueLimits as $qCode => $mueValue) {
            DB::table('msc_products')
                ->where('q_code', $qCode)
                ->update([
                    'mue' => $mueValue,
                    'updated_at' => now()
                ]);
        }

        // Log the update
        $updatedCount = DB::table('msc_products')
            ->whereIn('q_code', array_keys($this->mueLimits))
            ->whereNotNull('mue')
            ->count();

        echo "Updated MUE values for {$updatedCount} products.\n";
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        // Set MUE values back to null for affected products
        DB::table('msc_products')
            ->whereIn('q_code', array_keys($this->mueLimits))
            ->update([
                'mue' => null,
                'updated_at' => now()
            ]);
    }
};
